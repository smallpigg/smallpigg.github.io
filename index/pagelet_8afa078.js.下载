define("pagelet/site-v2/popup-window/audit/audit.js",function(i,e,t){t.exports=Pagelet.extend({el:"#auditPopupWindow",events:{},init:function(){this.el=$(this.el);var i=this;listener.on("com.neihanshequ","showAudit",function(){i.show()})},show:function(){this.el.show()},hide:function(){this.el.hide()}})});
;define("pagelet/site-v2/popup-window/login/login.js",function(e,i,n){var o=e("common/util/user.js");n.exports=Pagelet.extend({el:"#loginPopupWindow",events:{"click .share-items li":"onSelectLoginType"},init:function(){this.el=$(this.el),listener.on("com.neihanshequ","showLogin",this.show.bind(this))},show:function(){this.el.show()},hide:function(){this.el.hide()},onSelectLoginType:function(e){var i=$(e.currentTarget),n=i.data("type"),t=this;o.loginByOther(n,{openWindow:!0,successCb:function(){t.hide()}})}})});
;define("pagelet/site-v2/popup-window/need-login/need-login.js",function(e,n,i){i.exports=Pagelet.extend({el:"#needLoginPopupWindow",events:{"click #showLoginBtn":"showLogin"},init:function(){this.el=$(this.el);var e=this;listener.on("com.neihanshequ","showNeedLogin",function(){e.show()})},show:function(){this.el.show()},hide:function(){this.el.hide()},showLogin:function(){listener.trigger("com.neihanshequ","showLogin"),this.hide()}})});
;define("pagelet/site-v2/popup-window/post/post.js",function(require,exports,module){var CONTENT_TYPE={DEFAULT:3,IMAGE:1,VIDEO:2},showTips=function(e){listener.trigger("com.neihanshequ","popupTip",{text:e,timeout:1500})},showErrorTips=function(e){showTips("error"==e.message?e.data&&e.data.description?e.data.description:e.msg||e.message||e.data:e.message)},TOTAL_WORD_COUNT=300,onInputChangeMethod="input";$.browser.msie&&$.browser.version<=8&&(onInputChangeMethod="keyup");var inputChangeEventKey=onInputChangeMethod+" #postContent",material_id="",current_video={f:"",ts:0,te:0,fs:0},upload_log_code={unknow_error_code:-2,no_code:-1};module.exports=Pagelet.extend({el:"#postPopupWindow",events:{"click .tabs li":"onChangeTag","change #file":"uploadFile","submit #publishForm":"doSubmit","click .img-preview-wrapper .clear":"clearUploadFile"},defaultVideoThumb:"//s3a.pstatp.com/resource/neihan_web/static/image/site-v2/post/video_thumb_dcd9853.png",init:function(opts){this.events[inputChangeEventKey]="updateRemainCount",this.options=opts||{},this.el=$(this.el);var self=this;listener.on("com.neihanshequ","showPost",function(e,i){if(self.show(),$.isArray(i)){var t=i[1],s=i[2];t&&s&&(s=decodeURIComponent(s),self.el.find("#postContent").val("#"+s+"#"),self.el.find('input[name="activity_id"]').val(t))}}),this.reset();var $upload_form=this.el.find("#upload"),self=this;$(function(){function __updateProcessBar(e){(!$.browser.msie||$.browser.version>8)&&$processBar.css("width",e)}var $processBar=(self.el.find('input[name="from_iframe"]').val(""),self.el.find(".process-bar")),$submitBtn=self.el.find("#submitBtn");$upload_form.ajaxForm({beforeSend:function(){var e="0%";$submitBtn.val("正在上传"),__updateProcessBar(e);var i="funnyvideo"==self.currentTag,t=self.el.find("#file"),s=t[0].files[0];i&&(current_video.f=t.val(),current_video.ts=+new Date,current_video.fs=s.size||0)},uploadProgress:function(e,i,t,s){var r=s+"%";console.log(r),__updateProcessBar(r)},success:function(){var e="100%";console.log(e),__updateProcessBar(e)},complete:function(xhr){function imgloader(e){return"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+path+"', sizingMethod='"+e+"')"}self.releaseUploading(),$submitBtn.val("提交");var d=null;try{d=JSON.parse(xhr.responseText)}catch(e){}var is_video="funnyvideo"==self.currentTag;if(!d)return showTips("上传失败"),self.content_type=CONTENT_TYPE.DEFAULT,void(is_video&&self.collectUserUploadLog(upload_log_code.unknow_error_code));if("success"==d.message){var data=d.data,img_url="",$previewImg=self.el.find("#previewImg"),$file_input=self.el.find("#file");try{img_url=is_video?data.poster_url?data.poster_url:self.defaultVideoThumb:data.image_url_list[0].url}catch(e){}if(is_video&&!img_url)return showTips("上传失败"),self.content_type=CONTENT_TYPE.DEFAULT,void self.collectUserUploadLog(d.code);if(is_video)self.el.find('input[name="material_id"]').val(material_id),$previewImg.attr("src",img_url),current_video.te=+new Date,self.collectUserUploadLog(d.code);else if(self.el.find('input[name="material_id"]').val(data.material_id),"FileReader"in window){var image=$file_input[0].files[0],reader=new FileReader;reader.onload=function(){$previewImg.attr("src",reader.result)},reader.readAsDataURL(image)}else if($.browser.msie){{var path=$file_input.val(),tt=document.createElement("img"),name=path.slice(path.lastIndexOf("\\")+1);$('<img id="preview_fake" style="visibility:hidden;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale);"/>')}with("XMLHttpRequest"in window&&($file_input[0].select(),$file_input[0].blur(),path=document.selection.createRange().text,document.selection.empty()),$("body").append(tt),tt.runtimeStyle)filter=imgloader("image"),zoom=width=height=1,position="absolute",right="9999em",top="-9999em",border=0;var info={height:tt.offsetHeight,width:tt.offsetWidth,name:name,src:imgloader("scale")};if(info.height>1||info.width>1){var $el=$("#fakeImgPreviewer").html('<div class="viewpic"></div>');$el[0].style.filter=imgloader("scale"),$("#fakeImgPreviewer").removeClass("hidden"),$("#previewImg").addClass("hidden")}else{console.error("error");try{$previewImg.attr("src",data.url_list[0].url)}catch(e){}}tt.parentNode.removeChild(tt)}self.el.addClass("show-img-preview"),self.content_type=is_video?CONTENT_TYPE.VIDEO:CONTENT_TYPE.IMAGE}else showErrorTips(d),self.content_type=CONTENT_TYPE.DEFAULT,is_video&&self.collectUserUploadLog(upload_log_code.no_code)}})}),this.initCategoryList()},initCategoryList:function(){var e=this;$.ajax({url:"/api/get_categories/?r="+Math.random(),type:"GET",dataType:"json"}).done(function(i){var t=i.categories||[];if(t.length){var s=e.el.find("#categorySelector"),r=$("<option>",{value:0}).text("选择频道...");s.append(r),$.each(t,function(e,i){r=$("<option>",{value:i.id}).text(i.name),s.append(r)}),s.parents(".category-wrapper").removeClass("hidden"),e.el.addClass("has-category")}}).fail(function(){})},reset:function(){this.currentTag="joke",this.content_type=CONTENT_TYPE.DEFAULT,this.el.find(".tabs li").removeClass("active"),this.el.find('li[data-tag="'+this.currentTag+'"]').addClass("active"),this.el.find("#postContent").val(""),this.updateRemainCount(),this.clearUploadFile(),this.releaseUploading(),this.isSubmit=!1,this.showHideFileSelector(!1)},clearUploadFile:function(e){return e&&(e.stopPropagation(),e.preventDefault()),this.el.find("#file").val("")[0].value="",this.el.find('input[name="material_id"]').val(""),this.el.removeClass("show-img-preview"),this.el.find(".process-bar").css("width",0),this.el.find("#submitBtn").val("提交"),$.browser.msie&&$.browser.version<=9?(this.el.find("#upload").removeClass("hidden"),this.el.find('input[name="from_iframe"]').val("1")):this.el.find('input[name="from_iframe"]').val(""),!1},updateRemainCount:function(){var e=this.el.find("#postContent"),i=e.val(),t=i.length,s=TOTAL_WORD_COUNT-t;$(".words-remain span").text(s)},show:function(){this.el.show(),this.reset(),"undefined"!=typeof _gaq&&_gaq.push(["_trackPageview","/publish/"])},hide:function(){this.el.hide()},showHideFileSelector:function(e){if(e){this.el.find(".select-file-tip").show();var i=this.el.find(".file-input").show(),t=this.el.find("#upload").show();$.browser.msie&&(t.css("opacity","1").addClass("ie"),i.css("opacity",0))}else this.el.find(".select-file-tip").hide(),this.el.find(".file-input").hide(),this.el.find("#upload").hide();this.showHideError(!1)},isActionLock:function(){return this.isUploading||this.isSubmit},lockUploading:function(){this.isUploading=!0,this.el.find("#file").attr("disabled","disabled")},releaseUploading:function(){this.isUploading=!1,this.el.find("#file").removeAttr("disabled")},lockSubmit:function(){this.isSubmit=!0,this.el.find("#submitBtn").attr("disabled","disabled")},releaseSubmit:function(){this.isSubmit=!1,this.el.find("#submitBtn").removeAttr("disabled")},showHideError:function(e,i){var t=this.el.find("#fileUploadError").text(i||"");e?(t.css("visibility","visible"),this.el.find("#submitBtn").attr("disabled","disabled")):(t.css("visibility","hidden"),this.el.find("#submitBtn").removeAttr("disabled"))},onChangeTag:function(e){var i=$(e.currentTarget),t=i.data("tag");i.parent().find("li").removeClass("active"),i.addClass("active"),this.currentTag=t,this.el.find('input[name="tag"]').val(this.currentTag);this.el.find(".file-input");"joke"==t?(this.showHideFileSelector(!1),this.content_type=CONTENT_TYPE.DEFAULT):(this.showHideFileSelector(!0),this.content_type="funny_heavy"==t?CONTENT_TYPE.IMAGE:CONTENT_TYPE.VIDEO,this.content_type==CONTENT_TYPE.VIDEO?$("#videoUploadTip").show():$("#videoUploadTip").hide())},onSelectFile:function(){this.el.find("#file").trigger("click")},isSpecialUser:function(){if(!window.isUserLogin())return!1;var e=["5910440735","3781024058","4682781772"],i=window.getCurrentUser();return i&&i.user_id&&$.inArray(i.user_id,e)>-1?!0:!1},uploadFile:function(e){if(this.isActionLock())return!1;var i=$(e.currentTarget),t=i.val();if(!t)return!1;var s="funnyvideo"==this.currentTag;if(!s&&!/.(jpg|png|jpeg|gif)/gi.test(t))return this.showHideError(!0,"请选择图片文件,后缀必须是jpg,png,jpeg,gif"),i.val(""),!1;if(s&&!/.(mp4|avi|rmvb|rm|flv|mpeg|ra|ram|mov|wmv)/gi.test(t))return this.showHideError(!0,"请选择视频文件,后缀必须是mp4,avi,rmvb,rm,flv,mpeg,ra,ram,mov,wmv"),i.val(""),!1;if(i[0].files){var r=i[0].files[0].size;if(s&&r>524288e3&&!this.isSpecialUser())return this.showHideError(!0,"最多上传500M大小的文件"),i.val(""),!1;if(!s&&r>20971520)return this.showHideError(!0,"最多上传20M大小的文件"),i.val(""),!1}var a=this;if(s){var o=window.URL||window.webkitURL;if(o&&i[0].files){var n=o.createObjectURL(i[0].files[0]),l=document.querySelector("video");if(l){l.src=n;var d=setTimeout(function(){a.uploadSubmit(i,s)},1500);l.onloadedmetadata=function(){clearTimeout(d);var e=parseInt(l.duration,10);e>300&&!a.isSpecialUser()?(a.showHideError(!0,"视频大小不能大于5分钟"),i.val("")):a.uploadSubmit(i,s)}}else a.uploadSubmit(i,s)}else a.uploadSubmit(i,s)}else a.uploadSubmit(i,s)},uploadSubmit:function(e,i){var t=this;t.showHideError(!1);var s=e.parent();i?s.attr("action",t.getVideoUploadUrl()):s.attr("action",s.attr("image-action")),e.parent().submit(),setTimeout(function(){t.lockUploading()},100)},doSubmit:function(e){if(e.preventDefault(),e.stopPropagation(),this.isActionLock())return!1;if($("#postContent").val().length>TOTAL_WORD_COUNT)return showTips("您写的太多啦，字数上限是"+TOTAL_WORD_COUNT+"哦！"),!1;if(this.content_type!=CONTENT_TYPE.DEFAULT&&!$('input[name="material_id"]').val())return showTips("对不起，此处不允许发送纯文字"),!1;var i=$(e.currentTarget),t=this;i.find('input[name="content_type"]').val(this.content_type),this.isSubmit=!0,$.post(i.attr("action"),i.serialize()).done(function(e){"success"==e.message?(showTips(t.options.isProxyUser?"提交成功,正在接受审核，group_id:"+e.group_id:"提交成功,正在接受审核"),t.reset(),t.hide()):showErrorTips(e)}).fail(function(){showTips("网络错误,请稍候重试")}).always(function(){t.isSubmit=!1})},exec_api:function(e,i,t){var s=null,r=this;return $.ajax({type:t||"POST",async:i,url:"/file/video_upload_info/",data:{json_data:JSON.stringify(e)},dataType:"json",success:function(e){"success"==e.message?s=e.data:r.showHideError(!0,"抱歉，服务异常，请稍后再试")},timeout:3e3,error:function(){r.showHideError(!0,"抱歉，服务异常，请稍后再试")}}),s},getVideoUploadUrl:function(){var e={api:"get_upload_info"},i=null,i=this.exec_api(e,!1);return material_id=i.material_id,i.upload_url},collectUserUploadLog:function(e){var i="";if(window.getCurrentUser){var t=window.getCurrentUser();i=t.user_id}var s={sv:"1.0",u:i,f:current_video.f,e:e,fs:current_video.fs,r:0,et:0,ts:current_video.ts,te:+new Date,ua:navigator.userAgent,ref_id:material_id};$.ajax({type:"POST",url:"/video/report_error/",data:{id:material_id,data:JSON.stringify(s)},dataType:"json",success:function(){},timeout:3e3})}})});
;define("pagelet/site-v2/popup-window/report/report.js",function(e,t,i){i.exports=Pagelet.extend({el:"#reportPopupWindow",events:{"click ul li":"onSelectType","click .submit-btn":"onSubmit"},init:function(){this.el=$(this.el),listener.on("com.neihanshequ","showReport",function(e,t){this.reportId=t,this.show()}.bind(this)),this.reset()},reset:function(){this.selectType="",this.el.find("li").removeClass("select")},show:function(){this.reset(),this.el.show()},hide:function(){this.el.hide()},onSelectType:function(e){$ct=$(e.currentTarget),$ct.parent().find("li").removeClass("select"),$ct.addClass("select"),this.selectType=$ct.data("type")},onSubmit:function(){this.doSubmit=!0;var e=this;$.ajax({url:"/m/api/1/report_json/",type:"post",dataType:"json",data:{group_id:this.reportId,report_type:this.selectType}}).done(function(t){"success"===t.message?(e.hide(),listener.trigger("com.neihanshequ","popupTip",{text:"举报成功"})):e.onError()}).fail(function(){e.onError()}).always(function(){e.doSubmit=!1})}})});
;define("pagelet/site-v2/share/share.js",function(e,t,i){var h=e("common/util/bdshare.js");i.exports=Pagelet.extend({el:"#shareWindow",events:{"click ul li":"onShare"},init:function(){this.el=$(this.el),listener.on("com.neihanshequ","showShare",function(e,t,i){this.shareObject=i,this.show(t)}.bind(this)),listener.on("com.neihanshequ","hideShare",function(){this.hide()}.bind(this)),this.height=this.el.height(),this.width=this.el.width(),this.reset();var e=this;this.el.mouseover(function(){clearTimeout(window.__nh_showShareTimeId)}).mouseout(function(){clearTimeout(window.__nh_showShareTimeId),window.__nh_showShareTimeId=setTimeout(function(){e.hide()},300)})},reset:function(){},show:function(e){this.reset();var t=e.offset();this.el.css("top",t.top-this.height-7),this.el.css("left",t.left-this.width+e.innerWidth()),this.el.show()},hide:function(){this.el.hide()},onShare:function(e){var t=$(e.currentTarget);h(t.data("shareType").replace("bds_",""),this.shareObject);var i={bds_tsina:"share",bds_tqq:"share",bds_qzone:"share_qzone"};$.ajax({url:"/m/api/item_action/",type:"POST",dataType:"json",data:{action:i[t.data("shareType")],group_id:this.shareObject.groupId,app_name:"neihanshequ_web"}}).done(function(){}).fail(function(){console.error("ERROR")})}})});
;define("pagelet/site-v2/tips/tips.js",function(t,i,e){e.exports=Pagelet.extend({el:"#tips",events:{},init:function(){this.el=$(this.el),this.tl=new Tweenable,listener.on("com.neihanshequ","popupTip",this.onPopup.bind(this))},onPopup:function(t,i){i=$.extend({},this.DEFAULT_DATA,i),i.text=i.text||"操作成功";var e=this,n=this.el.find(".content").text(i.text);this.el.attr("class","").attr("class",i.cls),this.el.show(),this.tl.setConfig({from:{opacity:.3},to:{opacity:.8},duration:300,step:function(t){n.css("opacity",t.opacity)},finish:function(){setTimeout(function(){e.tl.setConfig({from:{opacity:.8},to:{opacity:0},duration:300,step:function(t){n.css("opacity",t.opacity)},finish:function(){e.hide()}}),e.tl.tween()},i.timeout||500)}}),this.tl.tween()},hide:function(){this.el.hide()}})});