define("common/listview/comments.js",function(require,exports,module){var TEMPLATE=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){__p+="";for(var i=0,len=data.length;len>i;i++){var the_data=data[i];__p+='\r\n\r\n<li class="comment-item">\r\n    <a href="/user/'+(null==(__t=the_data.user_id)?"":__t)+'/">\r\n        <img class="user-img lazy-load left" data-src="'+(null==(__t=the_data.user_profile_image_url)?"":__t)+'" alt="" onerror="this.src=\'http://mat1.gtimg.com/www/mb/images/head_50.jpg\'">\r\n        <div class="name-time-wrapper indent">\r\n            <span class="name">'+(null==(__t=htmlEntities(the_data.user_name))?"":__t)+'</span>\r\n            <span class="time timeago" title="'+(null==(__t=+new Date(1e3*the_data.create_time))?"":__t)+'">14-12-03 14:30</span>\r\n\r\n            <div class="options" data-comment-id="'+(null==(__t=the_data.id)?"":__t)+'" data-group-id="'+(null==(__t=group_id)?"":__t)+'">\r\n                <span class="digg-comment digg ',the_data.user_digg&&(__p+="ed"),__p+=' J-number-format" data-user-id="'+(null==(__t=the_data.user_id)?"":__t)+'">'+(null==(__t=the_data.digg_count)?"":__t)+'</span>\r\n                <span class="bury-comment bury ',the_data.user_bury&&(__p+="ed"),__p+=' J-number-format" data-user-id="'+(null==(__t=the_data.user_id)?"":__t)+'">'+(null==(__t=the_data.bury_count)?"":__t)+'</span>\r\n                <span class="repost-comment repost"></span>\r\n            </div>\r\n        </div>\r\n    </a>\r\n    <p class="indent">'+(null==(__t=htmlEntities(the_data.text))?"":__t)+"</p>\r\n</li>\r\n"}__p+=""}return __p},EVENT="comment-listview";eval("var DEFAULT_CONFIG = {\r\n	url: '',\r\n	has_more: false,\r\n	min_time: '',\r\n	max_time: '',\r\n	ctn: '',\r\n	is_god_comment: false,\r\n	offset: 0,\r\n	count: 40\r\n};\r\n\r\nvar htmlEntities = function htmlEntities(str){\r\n    return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\r\n};\r\n\r\nvar DEFAULT_DATA = {\r\n	is_god_comment: false,\r\n	is_detail: false,\r\n	channel: '',\r\n	htmlEntities: htmlEntities\r\n};\r\n\r\nvar EVENT_TYPE = {\r\n	LOAD_MORE: 'loadmore',\r\n	LOAD_LATEST: 'loadlatest',\r\n	LOAD_COMMENTS: 'loadcomments',\r\n	LOAD_MORE_COMMENTS: 'loadmore-comments',\r\n	APPEND_COMMENTS: 'append-comments'\r\n};\r\n\r\nfunction _init() {\r\n	listener.on('com.neihanshequ', EVENT, load);\r\n}\r\n\r\nfunction _offEvent() {\r\n	listener.off('com.neihanshequ', EVENT, load);\r\n}\r\n\r\nfunction canDoAjax(type, config) {\r\n	if(type === EVENT_TYPE.LOAD_MORE) {\r\n		return config.has_more;\r\n	}else if(type === EVENT_TYPE.LOAD_LATEST) {\r\n		return true;\r\n	}else if(type === EVENT_TYPE.LOAD_COMMENTS || \r\n			 type === EVENT_TYPE.LOAD_MORE_COMMENTS) {\r\n		return config.has_more;\r\n	} \r\n	return false;\r\n}\r\n\r\nfunction canDo(type, config) {\r\n	if(type === EVENT_TYPE.APPEND_COMMENTS) {\r\n		return true;\r\n	}\r\n	return false;\r\n}\r\n\r\nfunction getParams(type, config) {\r\n	var data = {};\r\n\r\n	if(type === EVENT_TYPE.LOAD_MORE) {\r\n		data = {\r\n			max_time: config.max_time\r\n		};\r\n		if('page' in config && 'count' in config) {\r\n			data = {\r\n				page: config.page,\r\n				count: config.count\r\n			};\r\n		}\r\n	}else if(type === EVENT_TYPE.LOAD_LATEST) {\r\n		data = {\r\n			min_time: config.min_time\r\n		};\r\n	}else if(type === EVENT_TYPE.LOAD_COMMENTS || \r\n			 type === EVENT_TYPE.LOAD_MORE_COMMENTS) {\r\n		data = {\r\n			offset: config.offset\r\n		};\r\n	} \r\n	return data;\r\n}\r\n\r\nfunction load(event, type, config) {\r\n	// config = $.extend({}, DEFAULT_CONFIG, config);\r\n	for(var key in DEFAULT_CONFIG) {\r\n		if(!config.hasOwnProperty(key)) {\r\n			config[key] = DEFAULT_CONFIG[key];\r\n		}\r\n	}\r\n\r\n	function __deferResolve(data) {\r\n		if(config.defer) {\r\n			config.defer.resolve(data);\r\n			delete config['defer'];\r\n		}\r\n	}\r\n	if(canDoAjax(type, config)) {\r\n		$('.loading-more').show();\r\n		_offEvent();\r\n		var paramData = getParams(type, config);\r\n		$.ajax({\r\n			url: config.url,\r\n			type: 'get',\r\n			dataType: 'json',\r\n			data: paramData\r\n		}).done(function(data) {\r\n			/**\r\n			 * 这里首先进行loading元素的消失，这样优先于添加数据的模块，可以确保消失过程动画不卡顿\r\n			 */\r\n			listener.trigger('bytefe.pull2refresh', 'reset');\r\n			if(data.message === 'success' || data.data.message == 'success') {\r\n				/**\r\n				 * 这里用timeout的形式触发，是为了延迟100ms来给前面loading元素消失动画\r\n				 * 足够的时间完成动画过程，避免渲染操作卡顿住消失动画\r\n				 */\r\n				setTimeout(function() {\r\n					_render(type, config, data);\r\n					__deferResolve(data);\r\n				}, 100);\r\n			}else {\r\n				console.log('onError', data.message);\r\n			}\r\n		}).fail(function() {\r\n			console.log('onError');\r\n			__deferResolve();\r\n		}).always(function() {\r\n			_init();\r\n		});	\r\n	}else if(canDo(type, config)) {\r\n		_render(type, config, config.data);\r\n	}else {\r\n		$('.loading-more').hide();\r\n	}\r\n}\r\n\r\nfunction _renderLoadMore(config, data) {\r\n	var d = $.extend({}, DEFAULT_DATA, data.data);\r\n	d.is_god_comment = config.is_god_comment;\r\n	var html = TEMPLATE(d);\r\n	$(config.ctn).hide().append(html).show();	\r\n}\r\n\r\nfunction _renderLoadLatest(config, data) {\r\n	var d = $.extend({}, DEFAULT_DATA, data.data);\r\n	d.is_god_comment = config.is_god_comment;\r\n	\r\n	var html = TEMPLATE(d);\r\n\r\n	$(config.ctn).prepend(html);\r\n\r\n	global_tip(data.data.tip);\r\n	\r\n}\r\n\r\nfunction _renderLoadComments(config, data) {\r\n	var hideSofa = false;\r\n	var hotTarget = $(config.ctn).find('.hot-comments');\r\n	var target = $(config.ctn).find('.comments');\r\n\r\n	if(data.data.top_comments && data.data.top_comments.length > 0) {\r\n	 	var html = TEMPLATE({data: data.data.top_comments, group_id: data.group_id, htmlEntities: htmlEntities});\r\n	 	hideSofa = true;\r\n	 	hotTarget.find('.comment-list').empty().append(html);	\r\n	 	hotTarget.find('.J-comments-count').text((data.data.top_comments||[]).length);\r\n	 	hotTarget.removeClass('hidden')\r\n	}else {\r\n	 	hotTarget.addClass('hidden');\r\n	}\r\n\r\n	if(data.data.recent_comments && data.data.recent_comments.length > 0) {\r\n		var html = TEMPLATE({data: data.data.recent_comments, group_id: data.group_id, htmlEntities: htmlEntities});\r\n		hideSofa = true;\r\n		\r\n		target.find('.comment-list').empty().append(html);\r\n		target.find('.J-comments-count').text(data.total_number - (data.data.top_comments||[]).length);\r\n		target.removeClass('hidden');\r\n	}else {\r\n		target.addClass('hidden');\r\n	}\r\n\r\n	// if(hideSofa) {\r\n	// 	$(config.ctn).find('.no-comments').hide();\r\n	// }else {\r\n	// 	$(config.ctn).find('.no-comments').show();\r\n	// }\r\n}\r\n\r\nfunction _renderLoadMoreComments(config, data) {\r\n	var target = $(config.ctn).find('.comments');\r\n	if(data.data.recent_comments && data.data.recent_comments.length > 0) {\r\n		var html = TEMPLATE({data: data.data.recent_comments, group_id: data.group_id, htmlEntities: htmlEntities});\r\n		target.find('.comment-list').append(html);\r\n		target.removeClass('hidden')\r\n		//$(config.ctn).append(html);\r\n	}\r\n}\r\n\r\nfunction _renderAppendComments(config, data) {\r\n	var target = $(config.ctn).find('.comments');\r\n	if(data.data.comments && data.data.comments.length > 0) {\r\n		//$(config.ctn).find('.no-comments').hide();\r\n		var html = TEMPLATE({data: data.data.comments, group_id: data.group_id, htmlEntities: htmlEntities});\r\n		target.find('.comment-list').prepend(html);\r\n		target.removeClass('hidden');\r\n		target.find('.J-comments-count').each(function(idx, el) {\r\n			el = $(el);\r\n			el.text(~~el.text()+data.data.comments.length);\r\n		});\r\n	}\r\n}\r\n\r\nvar renderMethodMap = {};\r\n\r\nrenderMethodMap[EVENT_TYPE.LOAD_MORE] = _renderLoadMore;\r\nrenderMethodMap[EVENT_TYPE.LOAD_LATEST] = _renderLoadLatest;\r\nrenderMethodMap[EVENT_TYPE.LOAD_COMMENTS] = _renderLoadComments;\r\nrenderMethodMap[EVENT_TYPE.LOAD_MORE_COMMENTS] = _renderLoadMoreComments;\r\nrenderMethodMap[EVENT_TYPE.APPEND_COMMENTS] = _renderAppendComments;\r\n\r\nfunction getRenderMethod(type) {\r\n	return renderMethodMap[type] || function() {};\r\n}\r\n\r\nvar afterRenderMethodMap = {};\r\n\r\nfunction _afterRenderComments(type, config, data) {\r\n	$(config.ctn).find('.timeago').timeago();\r\n	formatCountNumber();\r\n	loadLazyImage();\r\n}\r\n\r\nvar totalRenderedPostCount = 20;\r\nvar INSERT_AD_STEP = 40;\r\nvar latestADPos = 0;\r\nfunction _afterRenderPost(type, config, data) {\r\n	totalRenderedPostCount += data.data.data.length;\r\n	if(isNaN(totalRenderedPostCount)) {\r\n		return;\r\n	} \r\n	var $ctn = $(config.ctn);\r\n	$ctn.hide();\r\n\r\n	var appBanner = $('#appDownload');\r\n	var totalPost = $ctn.find('li.group-item');\r\n	var idx = Math.floor(latestADPos / INSERT_AD_STEP);\r\n	while(true) {\r\n		pos = idx*INSERT_AD_STEP-1;\r\n		if(pos > totalRenderedPostCount) {\r\n			break;\r\n		}else if(pos > latestADPos){\r\n			var clone = appBanner.clone();\r\n			clone.removeAttr('id');\r\n			clone.removeClass('fly-away');\r\n			clone.addClass('banner-in-list');\r\n			clone.data('adIdx', pos+1);\r\n			clone.insertAfter($(totalPost[pos]));\r\n			latestADPos = pos+1;\r\n		}\r\n		idx++;\r\n	}\r\n\r\n	if(!('gGroupIdList' in window)) {\r\n		window.gGroupIdList = [-1];\r\n	}\r\n\r\n	var len = gGroupIdList.length;\r\n	var list = [].concat(data.data.data);\r\n	if(type == EVENT_TYPE.LOAD_LATEST) {\r\n		list = list.reverse();\r\n	}\r\n	$(list).each(function(idx, d) {\r\n		var group = d.group || d;\r\n		if(type == EVENT_TYPE.LOAD_LATEST) {\r\n			gGroupIdList.unshift(''+group.group_id);\r\n		}else if(type == EVENT_TYPE.LOAD_MORE) {\r\n			gGroupIdList.splice(len-1, 0, ''+group.group_id);\r\n			len++;\r\n		}\r\n	});\r\n\r\n	saveGroupIdList(gGroupIdList);	\r\n	\r\n	formatCountNumber();\r\n\r\n\r\n	$ctn.show();\r\n}\r\n\r\nafterRenderMethodMap[EVENT_TYPE.LOAD_LATEST] = _afterRenderPost;\r\nafterRenderMethodMap[EVENT_TYPE.LOAD_MORE] = _afterRenderPost;\r\nafterRenderMethodMap[EVENT_TYPE.LOAD_COMMENTS] = _afterRenderComments;\r\nafterRenderMethodMap[EVENT_TYPE.LOAD_MORE_COMMENTS] = _afterRenderComments;\r\nafterRenderMethodMap[EVENT_TYPE.APPEND_COMMENTS] = _afterRenderComments;\r\n\r\nfunction getAfterRenderMethod(type) {\r\n	return afterRenderMethodMap[type] || function() {};\r\n}\r\n\r\nfunction _render(type, config, data) {\r\n\r\n	var renderMethod = getRenderMethod(type);\r\n	renderMethod(config, data);\r\n	\r\n	setTimeout(function() {\r\n		var afterRenderMethod = getAfterRenderMethod(type);\r\n		afterRenderMethod ? afterRenderMethod(type, config, data) : '';\r\n	}, 300);\r\n\r\n	_updateConfig(type, config, data);\r\n}\r\n\r\nfunction _updateConfig(type, config, data) {\r\n	if(type === EVENT_TYPE.LOAD_MORE) {\r\n		config.has_more = data.data.has_more && data.data.data.length > 0;\r\n		config.max_time = data.data.max_time || config.max_time;	\r\n\r\n		if('options' in data.data) {\r\n			config.page = data.data.options.page;\r\n			config.count = data.data.options.count;\r\n			config.has_more = data.data.hasmore;\r\n		}		\r\n	}else if(type === EVENT_TYPE.LOAD_LATEST) {\r\n		config.min_time = data.data.min_time || config.min_time;\r\n	}else if(type === EVENT_TYPE.LOAD_MORE_COMMENTS || \r\n			 type === EVENT_TYPE.LOAD_COMMENTS) {\r\n		config.offset += data.data.recent_comments.length;\r\n		config.has_more = data.has_more;\r\n	}\r\n\r\n	if(!config.has_more) {\r\n		$('.loading-more').hide();\r\n	}\r\n}\r\n\r\nmodule.exports = {\r\n	init: _init\r\n}")});
;define("common/listview/list.js",function(require,exports,module){var TEMPLATE=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){__p+="";for(var i=0,len=data.length;len>i;i++){var the_data=data[i].group||data[i],comments=(is_god_comment?data[i].comment:null,data[i].comments||[]);if(__p+='\r\n<li class="group-item">\r\n    <div class="detail-wrapper">\r\n        <div class="header">\r\n            ',the_data.comment?__p+='\r\n            <a href="/user/'+(null==(__t=the_data.comment.user_id)?"":__t)+'/">\r\n                <img class="avatar lazy-load left" data-src="'+(null==(__t=the_data.comment.user_profile_image_url)?"":__t)+'" onerror="this.src=\'http://mat1.gtimg.com/www/mb/images/head_50.jpg\'" alt="">\r\n                <div class="name-time-wrapper left">\r\n                    <span class="name">'+(null==(__t=the_data.comment.user_name)?"":__t)+'</span>\r\n                    <span class="time timeago" title="'+(null==(__t=the_data.comment.create_time)?"":__t)+'">\r\n                        '+(null==(__t=the_data.comment.create_time)?"":__t)+"\r\n                    </span>\r\n                </div>\r\n            </a>\r\n            ":(__p+='\r\n            <a href="/user/'+(null==(__t=the_data.user.user_id)?"":__t)+'/">\r\n                <img class="avatar lazy-load left" data-src="'+(null==(__t=the_data.user.avatar_url)?"":__t)+'" onerror="this.src=\'http://mat1.gtimg.com/www/mb/images/head_50.jpg\'" alt="">\r\n                <div class="name-time-wrapper left">\r\n                    <span class="name">'+(null==(__t=the_data.user.name)?"":__t),the_data.user.user_verified&&(__p+="<i class='user_verified'  title=\"微博认证用户\"></i>"),__p+='</span>\r\n                    <span class="time timeago" title="'+(null==(__t=the_data.create_time)?"":__t)+'000">\r\n                        '+(null==(__t=the_data.create_time)?"":__t)+"\r\n                    </span>\r\n                </div>\r\n            </a>\r\n            "),__p+="\r\n\r\n            ",(gListViewConfig.showReport||gListViewConfig.showCommented||gListViewConfig.showDelete)&&(__p+='\r\n            <div class="other-btn right">\r\n                ',gListViewConfig.showReport&&(__p+='\r\n                <button class="report-btn">举报</button>\r\n                '),__p+="\r\n                ",gListViewConfig.showCommented&&(__p+='\r\n                <span class="commented-txt">评论了</span>\r\n                '),__p+="\r\n                ",gListViewConfig.showDelete&&(__p+='\r\n                <div class="delete-btn" data-group-id="'+(null==(__t=the_data.group_id)?"":__t)+'"></div>\r\n                '),__p+="\r\n            </div>\r\n            "),__p+="\r\n        </div>\r\n\r\n        ",the_data.comment&&(__p+='\r\n        <div class="comment-wrapper">\r\n            <div class="upload-txt mt {%if not the_data.comment.text%}no-mb{%endif%}">\r\n                '+(null==(__t=the_data.comment.text)?"":__t)+'\r\n            </div>\r\n            <div class="origin">\r\n        '),__p+='\r\n        \r\n        <div class="content-wrapper">\r\n            ',__p+="undefined"!=typeof noLink&&noLink?"\r\n            <a>\r\n            ":'\r\n            <a target="_blank" class="image share_url" href="/p'+(null==(__t=the_data.group_id)?"":__t)+'/" data-group-id="'+(null==(__t=the_data.group_id)?"":__t)+'">\r\n            ',__p+='\r\n                <div class="upload-txt {%if not the_data.content){%>no-mb{%endif%} {%if not the_data.large_image and not the_data.mp4_url%}no-mb{%endif%}">\r\n                    '+(null==(__t=the_data.content)?"":__t)+"\r\n                </div>\r\n                ",the_data.large_image&&(__p+='\r\n                <div class="img-wrapper">\r\n                    ',__p+=the_data.large_image.url_list?'\r\n                    <img \r\n                        class="lazy upload-img" \r\n                        onerror="this.src='+(null==(__t=the_data.large_image.url_list[1].url)?"":__t)+'" \r\n                        data-image-info=\'{"l":{"w":"'+(null==(__t=the_data.large_image.width)?"":__t)+'","h":"'+(null==(__t=the_data.large_image.height)?"":__t)+'","s":"'+(null==(__t=the_data.large_image.url_list[0].url)?"":__t)+'","s1":"'+(null==(__t=the_data.large_image.url_list[1].url)?"":__t)+'"},"m":{"w":"'+(null==(__t=the_data.middle_image.width)?"":__t)+'","h":"'+(null==(__t=the_data.middle_image.height)?"":__t)+'","s":"'+(null==(__t=the_data.middle_image.url_list[0].url)?"":__t)+'","s1":"'+(null==(__t=the_data.middle_image.url_list[1].url)?"":__t)+"\"}}'>\r\n                    ":'\r\n                    <img \r\n                        class="lazy upload-img" \r\n                        src="'+(null==(__t=the_data.large_image)?"":__t)+'" \r\n                        onerror="this.src='+(null==(__t=the_data.middle_image)?"":__t)+'" data-image-info=\'{"l":{"w":"","h":"","s":"'+(null==(__t=the_data.large_image)?"":__t)+'"},"m":{"w":"","h":"","s":"'+(null==(__t=the_data.middle_image)?"":__t)+"\"}}'>\r\n                    ",__p+="\r\n                </div>\r\n                "),__p+="\r\n\r\n                ",the_data.mp4_url&&(__p+='\r\n                <div class="video-container" id="videoContainer">\r\n                    <div class="poster-page">\r\n                        <a class="poster-link" href="javascript:;">\r\n                            <div class="wrapper img-wrapper">\r\n                                <img \r\n                                    class="lazy poster J-share-img"\r\n                                    data-image-info=\'{"l":{"w":"'+(null==(__t=the_data.video_width)?"":__t)+'","h":"'+(null==(__t=the_data.video_height)?"":__t)+'","s":"'+(null==(__t=the_data.large_cover.url_list[0].url)?"":__t)+'","s1":"'+(null==(__t=the_data.large_cover.url_list[1].url)?"":__t)+'"},"m":{"w":"'+(null==(__t=the_data.video_width)?"":__t)+'","h":"'+(null==(__t=the_data.video_height)?"":__t)+'","s":"'+(null==(__t=the_data.medium_cover.url_list[0].url)?"":__t)+'","s1":"'+(null==(__t=the_data.medium_cover.url_list[1].url)?"":__t)+"\"}}'\r\n                                    onerror=\"this.src='"+(null==(__t=the_data.large_cover.url_list[1].url)?"":__t)+'\'" />\r\n                                <div class="play-btn" style="margin-left/*\\**/: -38px \\9;">\r\n                                    <div class="play-btn-arrow"></div>\r\n                                </div>\r\n                                <div class="desc">\r\n                                    <p class="play-count left"><span>'+(null==(__t=the_data.play_count)?"":__t)+'</span>次播放</p>\r\n                                    <p class="total-time right" data-duration="'+(null==(__t=the_data.duration)?"":__t)+'"></p>\r\n                                </div>\r\n                            </div>\r\n                        </a>\r\n                    </div>\r\n                    <div class="player-container" data-src="'+(null==(__t=the_data.mp4_url)?"":__t)+'" data-poster-src="'+(null==(__t=the_data.large_cover.url_list[0].url)?"":__t)+'">\r\n                        <video class="upload-video hidden" src="'+(null==(__t=the_data.mp4_url)?"":__t)+'" poster="'+(null==(__t=the_data.large_cover.url_list[0].url)?"":__t)+'" controls="controls" preload="none"></video>\r\n                    </div>\r\n                </div>\r\n                '),__p+="\r\n            </a>\r\n        </div>\r\n\r\n        ",comments&&comments.length){__p+='\r\n        <div class="god-comments-wrapper">\r\n            <div class="header">\r\n                <span>神评论</span>\r\n            </div>\r\n            <ul>\r\n                ';for(var j=0,l=comments.length;l>j;j++){var c=comments[j];__p+='\r\n                <li>\r\n                    <div>\r\n                        <a target="_blank" href="/user/'+(null==(__t=c.user_id)?"":__t)+'/">\r\n                            <img class="avatar lazy-load left" data-src="'+(null==(__t=c.avatar_url)?"":__t)+'" onerror="this.src=\'http://mat1.gtimg.com/www/mb/images/head_50.jpg\';">\r\n                            <span class="name">'+(null==(__t=c.user_name)?"":__t)+'</span>\r\n                        </a>\r\n                        <span class="digg digg-comment ',c.user_digg&&(__p+="ed"),__p+='" data-user-id="'+(null==(__t=c.user_id)?"":__t)+'" data-comment-id="'+(null==(__t=c.comment_id)?"":__t)+'" data-group-id="'+(null==(__t=the_data.group_id)?"":__t)+'" data-exist-action-'+(null==(__t=c.comment_id)?"":__t)+'="{%if c.user_digg%}digg{%endif%}" data-count="'+(null==(__t=c.digg_count)?"":__t)+'">'+(null==(__t=c.digg_count)?"":__t)+"</span>\r\n                    </div>\r\n                    <div>\r\n                        <p>"+(null==(__t=c.text)?"":__t)+"</p>\r\n                    </div>\r\n                </li>\r\n                "}__p+="\r\n            </ul>\r\n        </div>\r\n        "}__p+="\r\n\r\n        ","undefined"!=typeof noOptions&&noOptions||(__p+='\r\n        <div class="options" data-group-id="'+(null==(__t=the_data.group_id)?"":__t)+'">\r\n            <ul>\r\n                <li class="digg-wrapper">\r\n                    <span class="digg">'+(null==(__t=the_data.digg_count)?"":__t)+'</span>\r\n                </li>\r\n                <li class="bury-wrapper">\r\n                    <span class="bury">'+(null==(__t=the_data.bury_count)?"":__t)+'</span>\r\n                </li> \r\n                <li class="repin-wrapper">\r\n                    <span class="repin">'+(null==(__t=the_data.favorite_count)?"":__t)+'</span>\r\n                </li>\r\n                \r\n                <li class="share-wrapper right"\r\n                    data-group-id="'+(null==(__t=the_data.group_id)?"":__t)+'" \r\n                    data-url="http://neihanshequ.com/p'+(null==(__t=the_data.group_id)?"":__t)+'/"\r\n                    data-text="'+(null==(__t=the_data.content)?"":__t)+'"\r\n\r\n                    ',the_data.large_image&&the_data.large_image.url_list?__p+='\r\n                    data-pic="'+(null==(__t=the_data.large_image.url_list[0].url)?"":__t)+'"\r\n                    ':(__p+="\r\n                        ",__p+=the_data.mp4_url?'\r\n                        data-pic="'+(null==(__t=the_data.large_cover.url_list[0].url)?"":__t)+'"\r\n                        ':'\r\n                        data-pic="'+(null==(__t=the_data.large_image)?"":__t)+'"\r\n                        ',__p+="\r\n                    "),__p+='\r\n                >\r\n                    <span class="share"></span>\r\n                </li>\r\n                <li class="post-comment-btn right">\r\n                    <span class="comment">'+(null==(__t=the_data.comment_count)?"":__t)+"</span>\r\n                </li> \r\n            </ul>\r\n        </div>\r\n        "),__p+="\r\n\r\n        ",the_data.comment&&(__p+="\r\n            </div> <!-- end of orign -->\r\n        </div> <!-- end of comment-wrapper -->\r\n        "),__p+="\r\n        \r\n    </div>\r\n</li>\r\n"}__p+=""}return __p},EVENT="listview";eval("var DEFAULT_CONFIG = {\r\n	url: '',\r\n	has_more: false,\r\n	min_time: '',\r\n	max_time: '',\r\n	ctn: '',\r\n	is_god_comment: false,\r\n	offset: 0,\r\n	count: 40\r\n};\r\n\r\nvar htmlEntities = function htmlEntities(str){\r\n    return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\r\n};\r\n\r\nvar DEFAULT_DATA = {\r\n	is_god_comment: false,\r\n	is_detail: false,\r\n	channel: '',\r\n	htmlEntities: htmlEntities\r\n};\r\n\r\nvar EVENT_TYPE = {\r\n	LOAD_MORE: 'loadmore',\r\n	LOAD_LATEST: 'loadlatest',\r\n	LOAD_COMMENTS: 'loadcomments',\r\n	LOAD_MORE_COMMENTS: 'loadmore-comments',\r\n	APPEND_COMMENTS: 'append-comments'\r\n};\r\n\r\nfunction _init() {\r\n	listener.on('com.neihanshequ', EVENT, load);\r\n}\r\n\r\nfunction _offEvent() {\r\n	listener.off('com.neihanshequ', EVENT, load);\r\n}\r\n\r\nfunction canDoAjax(type, config) {\r\n	if(type === EVENT_TYPE.LOAD_MORE) {\r\n		return config.has_more;\r\n	}else if(type === EVENT_TYPE.LOAD_LATEST) {\r\n		return true;\r\n	}else if(type === EVENT_TYPE.LOAD_COMMENTS || \r\n			 type === EVENT_TYPE.LOAD_MORE_COMMENTS) {\r\n		return config.has_more;\r\n	} \r\n	return false;\r\n}\r\n\r\nfunction canDo(type, config) {\r\n	if(type === EVENT_TYPE.APPEND_COMMENTS) {\r\n		return true;\r\n	}\r\n	return false;\r\n}\r\n\r\nfunction getParams(type, config) {\r\n	var data = {};\r\n\r\n	if(type === EVENT_TYPE.LOAD_MORE) {\r\n		data = {\r\n			max_time: config.max_time\r\n		};\r\n		if('page' in config && 'count' in config) {\r\n			data = {\r\n				page: config.page,\r\n				count: config.count\r\n			};\r\n		}\r\n	}else if(type === EVENT_TYPE.LOAD_LATEST) {\r\n		data = {\r\n			min_time: config.min_time\r\n		};\r\n	}else if(type === EVENT_TYPE.LOAD_COMMENTS || \r\n			 type === EVENT_TYPE.LOAD_MORE_COMMENTS) {\r\n		data = {\r\n			offset: config.offset\r\n		};\r\n	} \r\n	return data;\r\n}\r\n\r\nfunction load(event, type, config) {\r\n	// config = $.extend({}, DEFAULT_CONFIG, config);\r\n	for(var key in DEFAULT_CONFIG) {\r\n		if(!config.hasOwnProperty(key)) {\r\n			config[key] = DEFAULT_CONFIG[key];\r\n		}\r\n	}\r\n\r\n	function __deferResolve(data) {\r\n		if(config.defer) {\r\n			config.defer.resolve(data);\r\n			delete config['defer'];\r\n		}\r\n	}\r\n	if(canDoAjax(type, config)) {\r\n		$('.loading-more').show();\r\n		_offEvent();\r\n		var paramData = getParams(type, config);\r\n		$.ajax({\r\n			url: config.url,\r\n			type: 'get',\r\n			dataType: 'json',\r\n			data: paramData\r\n		}).done(function(data) {\r\n			/**\r\n			 * 这里首先进行loading元素的消失，这样优先于添加数据的模块，可以确保消失过程动画不卡顿\r\n			 */\r\n			listener.trigger('bytefe.pull2refresh', 'reset');\r\n			if(data.message === 'success' || data.data.message == 'success') {\r\n				/**\r\n				 * 这里用timeout的形式触发，是为了延迟100ms来给前面loading元素消失动画\r\n				 * 足够的时间完成动画过程，避免渲染操作卡顿住消失动画\r\n				 */\r\n				setTimeout(function() {\r\n					_render(type, config, data);\r\n					__deferResolve(data);\r\n				}, 100);\r\n			}else {\r\n				console.log('onError', data.message);\r\n			}\r\n		}).fail(function() {\r\n			console.log('onError');\r\n			__deferResolve();\r\n		}).always(function() {\r\n			_init();\r\n		});	\r\n	}else if(canDo(type, config)) {\r\n		_render(type, config, config.data);\r\n	}else {\r\n		$('.loading-more').hide();\r\n	}\r\n}\r\n\r\nfunction _renderLoadMore(config, data) {\r\n	var d = $.extend({}, DEFAULT_DATA, data.data);\r\n	d.is_god_comment = config.is_god_comment;\r\n	var html = TEMPLATE(d);\r\n	$(config.ctn).hide().append(html).show();	\r\n}\r\n\r\nfunction _renderLoadLatest(config, data) {\r\n	var d = $.extend({}, DEFAULT_DATA, data.data);\r\n	d.is_god_comment = config.is_god_comment;\r\n	\r\n	var html = TEMPLATE(d);\r\n\r\n	$(config.ctn).prepend(html);\r\n\r\n	global_tip(data.data.tip);\r\n	\r\n}\r\n\r\nfunction _renderLoadComments(config, data) {\r\n	var hideSofa = false;\r\n	var hotTarget = $(config.ctn).find('.hot-comments');\r\n	var target = $(config.ctn).find('.comments');\r\n\r\n	if(data.data.top_comments && data.data.top_comments.length > 0) {\r\n	 	var html = TEMPLATE({data: data.data.top_comments, group_id: data.group_id, htmlEntities: htmlEntities});\r\n	 	hideSofa = true;\r\n	 	hotTarget.find('.comment-list').empty().append(html);	\r\n	 	hotTarget.find('.J-comments-count').text((data.data.top_comments||[]).length);\r\n	 	hotTarget.removeClass('hidden')\r\n	}else {\r\n	 	hotTarget.addClass('hidden');\r\n	}\r\n\r\n	if(data.data.recent_comments && data.data.recent_comments.length > 0) {\r\n		var html = TEMPLATE({data: data.data.recent_comments, group_id: data.group_id, htmlEntities: htmlEntities});\r\n		hideSofa = true;\r\n		\r\n		target.find('.comment-list').empty().append(html);\r\n		target.find('.J-comments-count').text(data.total_number - (data.data.top_comments||[]).length);\r\n		target.removeClass('hidden');\r\n	}else {\r\n		target.addClass('hidden');\r\n	}\r\n\r\n	// if(hideSofa) {\r\n	// 	$(config.ctn).find('.no-comments').hide();\r\n	// }else {\r\n	// 	$(config.ctn).find('.no-comments').show();\r\n	// }\r\n}\r\n\r\nfunction _renderLoadMoreComments(config, data) {\r\n	var target = $(config.ctn).find('.comments');\r\n	if(data.data.recent_comments && data.data.recent_comments.length > 0) {\r\n		var html = TEMPLATE({data: data.data.recent_comments, group_id: data.group_id, htmlEntities: htmlEntities});\r\n		target.find('.comment-list').append(html);\r\n		target.removeClass('hidden')\r\n		//$(config.ctn).append(html);\r\n	}\r\n}\r\n\r\nfunction _renderAppendComments(config, data) {\r\n	var target = $(config.ctn).find('.comments');\r\n	if(data.data.comments && data.data.comments.length > 0) {\r\n		//$(config.ctn).find('.no-comments').hide();\r\n		var html = TEMPLATE({data: data.data.comments, group_id: data.group_id, htmlEntities: htmlEntities});\r\n		target.find('.comment-list').prepend(html);\r\n		target.removeClass('hidden');\r\n		target.find('.J-comments-count').each(function(idx, el) {\r\n			el = $(el);\r\n			el.text(~~el.text()+data.data.comments.length);\r\n		});\r\n	}\r\n}\r\n\r\nvar renderMethodMap = {};\r\n\r\nrenderMethodMap[EVENT_TYPE.LOAD_MORE] = _renderLoadMore;\r\nrenderMethodMap[EVENT_TYPE.LOAD_LATEST] = _renderLoadLatest;\r\nrenderMethodMap[EVENT_TYPE.LOAD_COMMENTS] = _renderLoadComments;\r\nrenderMethodMap[EVENT_TYPE.LOAD_MORE_COMMENTS] = _renderLoadMoreComments;\r\nrenderMethodMap[EVENT_TYPE.APPEND_COMMENTS] = _renderAppendComments;\r\n\r\nfunction getRenderMethod(type) {\r\n	return renderMethodMap[type] || function() {};\r\n}\r\n\r\nvar afterRenderMethodMap = {};\r\n\r\nfunction _afterRenderComments(type, config, data) {\r\n	$(config.ctn).find('.timeago').timeago();\r\n	formatCountNumber();\r\n	loadLazyImage();\r\n}\r\n\r\nvar totalRenderedPostCount = 20;\r\nvar INSERT_AD_STEP = 40;\r\nvar latestADPos = 0;\r\nfunction _afterRenderPost(type, config, data) {\r\n	totalRenderedPostCount += data.data.data.length;\r\n	if(isNaN(totalRenderedPostCount)) {\r\n		return;\r\n	} \r\n	var $ctn = $(config.ctn);\r\n	$ctn.hide();\r\n\r\n	var appBanner = $('#appDownload');\r\n	var totalPost = $ctn.find('li.group-item');\r\n	var idx = Math.floor(latestADPos / INSERT_AD_STEP);\r\n	while(true) {\r\n		pos = idx*INSERT_AD_STEP-1;\r\n		if(pos > totalRenderedPostCount) {\r\n			break;\r\n		}else if(pos > latestADPos){\r\n			var clone = appBanner.clone();\r\n			clone.removeAttr('id');\r\n			clone.removeClass('fly-away');\r\n			clone.addClass('banner-in-list');\r\n			clone.data('adIdx', pos+1);\r\n			clone.insertAfter($(totalPost[pos]));\r\n			latestADPos = pos+1;\r\n		}\r\n		idx++;\r\n	}\r\n\r\n	if(!('gGroupIdList' in window)) {\r\n		window.gGroupIdList = [-1];\r\n	}\r\n\r\n	var len = gGroupIdList.length;\r\n	var list = [].concat(data.data.data);\r\n	if(type == EVENT_TYPE.LOAD_LATEST) {\r\n		list = list.reverse();\r\n	}\r\n	$(list).each(function(idx, d) {\r\n		var group = d.group || d;\r\n		if(type == EVENT_TYPE.LOAD_LATEST) {\r\n			gGroupIdList.unshift(''+group.group_id);\r\n		}else if(type == EVENT_TYPE.LOAD_MORE) {\r\n			gGroupIdList.splice(len-1, 0, ''+group.group_id);\r\n			len++;\r\n		}\r\n	});\r\n\r\n	saveGroupIdList(gGroupIdList);	\r\n	\r\n	formatCountNumber();\r\n\r\n\r\n	$ctn.show();\r\n}\r\n\r\nafterRenderMethodMap[EVENT_TYPE.LOAD_LATEST] = _afterRenderPost;\r\nafterRenderMethodMap[EVENT_TYPE.LOAD_MORE] = _afterRenderPost;\r\nafterRenderMethodMap[EVENT_TYPE.LOAD_COMMENTS] = _afterRenderComments;\r\nafterRenderMethodMap[EVENT_TYPE.LOAD_MORE_COMMENTS] = _afterRenderComments;\r\nafterRenderMethodMap[EVENT_TYPE.APPEND_COMMENTS] = _afterRenderComments;\r\n\r\nfunction getAfterRenderMethod(type) {\r\n	return afterRenderMethodMap[type] || function() {};\r\n}\r\n\r\nfunction _render(type, config, data) {\r\n\r\n	var renderMethod = getRenderMethod(type);\r\n	renderMethod(config, data);\r\n	\r\n	setTimeout(function() {\r\n		var afterRenderMethod = getAfterRenderMethod(type);\r\n		afterRenderMethod ? afterRenderMethod(type, config, data) : '';\r\n	}, 300);\r\n\r\n	_updateConfig(type, config, data);\r\n}\r\n\r\nfunction _updateConfig(type, config, data) {\r\n	if(type === EVENT_TYPE.LOAD_MORE) {\r\n		config.has_more = data.data.has_more && data.data.data.length > 0;\r\n		config.max_time = data.data.max_time || config.max_time;	\r\n\r\n		if('options' in data.data) {\r\n			config.page = data.data.options.page;\r\n			config.count = data.data.options.count;\r\n			config.has_more = data.data.hasmore;\r\n		}		\r\n	}else if(type === EVENT_TYPE.LOAD_LATEST) {\r\n		config.min_time = data.data.min_time || config.min_time;\r\n	}else if(type === EVENT_TYPE.LOAD_MORE_COMMENTS || \r\n			 type === EVENT_TYPE.LOAD_COMMENTS) {\r\n		config.offset += data.data.recent_comments.length;\r\n		config.has_more = data.has_more;\r\n	}\r\n\r\n	if(!config.has_more) {\r\n		$('.loading-more').hide();\r\n	}\r\n}\r\n\r\nmodule.exports = {\r\n	init: _init\r\n}")});
;define("common/listview/messages.js",function(require,exports,module){var TEMPLATE=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){__p+="";for(var i=0,len=data.length;len>i;i++){{var the_data=data[i].group||data[i];is_god_comment?data[i].comment:null}__p+='\r\n<li class="group-item">\r\n    <div class="detail-wrapper">\r\n        <div class="header">\r\n            ',__p+=50==the_data.update_type?"\r\n            <a>\r\n            ":'\r\n            <a href="/user/'+(null==(__t=the_data.user_id)?"":__t)+'/" target="_blank">\r\n            ',__p+="\r\n                ",__p+=50==the_data.update_type?'\r\n                <img class="avatar lazy-load left" data-src="/static/image/site-v2/sys-icon.png" onerror="this.src=\'http://mat1.gtimg.com/www/mb/images/head_50.jpg\'" alt="">\r\n                ':'\r\n                <img class="avatar lazy-load left" data-src="'+(null==(__t=the_data.avatar_url)?"":__t)+'" onerror="this.src=\'http://mat1.gtimg.com/www/mb/images/head_50.jpg\'" alt="">\r\n                ',__p+='\r\n                <div class="name-time-wrapper left">\r\n                    <span class="name">\r\n                        ',50==the_data.update_type?__p+="\r\n                        系统消息\r\n                        ":(__p+="\r\n                        "+(null==(__t=the_data.user_screen_name)?"":__t)+"\r\n                        ",the_data.user_verified&&(__p+="<i class='user_verified'  title=\"微博认证用户\"></i>"),__p+="\r\n                        "),__p+='\r\n\r\n                        <span class="time">'+(null==(__t=the_data.update_desc)?"":__t)+"</span>\r\n\r\n                        ",the_data.unread&&(__p+='\r\n                        <span class="new-msg" style="color:red;">  新消息</span>\r\n                        '),__p+='\r\n                    </span>\r\n                    <span class="time timeago">\r\n                        '+(null==(__t=new Date(1e3*the_data.display_time).format("M-d h:m"))?"":__t)+'\r\n                    </span>\r\n                </div>\r\n            </a>\r\n\r\n            <div class="other-btn right">\r\n                <div class="delete-btn hidden" data-group-id="'+(null==(__t=the_data.group_id)?"":__t)+'"></div>\r\n            </div>\r\n\r\n\r\n        </div>\r\n        <div class="content-wrapper" style="margin-bottom:0;">\r\n            ',"undefined"!=typeof noLink&&noLink?__p+="\r\n            <a>\r\n            ":(__p+="\r\n                ",41!=the_data.update_type&&60!=the_data.update_type?__p+='\r\n                <a target="_blank" class="image share_url" href="/p'+(null==(__t=the_data.group_id)?"":__t)+'/">\r\n                ':(__p+="\r\n                    ",60==the_data.update_type&&(__p+='\r\n                    <a target="_blank" class="image share_url" href="/user/'+(null==(__t=the_data.user_id)?"":__t)+'/">\r\n                    '),__p+="\r\n                "),__p+="\r\n            "),__p+="\r\n                ",the_data.text&&(__p+='\r\n                <div class="comment-wrapper">\r\n                    <div class="upload-txt">\r\n                        '+(null==(__t=the_data.text)?"":__t)+'\r\n                    </div>\r\n                    <div class="origin">\r\n                '),__p+='\r\n                \r\n                <div class="upload-txt mt ',the_data.content||(__p+="no-mb"),__p+=" ",the_data.large_image||the_data.mp4_url||(__p+="no-mb"),__p+='">\r\n                    '+(null==(__t=the_data.content)?"":__t)+"\r\n                </div>\r\n\r\n                ",the_data.large_image&&(__p+='\r\n                <img class="upload-img lazy-load" data-src="'+(null==(__t=the_data.large_image)?"":__t)+'" onerror="this.src=\''+(null==(__t=the_data.middle_image)?"":__t)+"'\">\r\n                "),__p+="\r\n                ",the_data.mp4_url&&(__p+='\r\n                <div class="video-container" id="videoContainer">\r\n                    <div class="poster-page ',"detail"==channel&&(__p+="hidden"),__p+='">\r\n                        <a class="poster-link" href="javascript:;">\r\n                            <div class="wrapper img-wrapper">\r\n                                <img \r\n                                    class="poster J-share-img" \r\n                                    alt="" \r\n                                    data-image-info=\'{"l":{"w":"'+(null==(__t=the_data.video_width)?"":__t)+'","h":"'+(null==(__t=the_data.video_height)?"":__t)+'","s":"'+(null==(__t=the_data.large_cover.url_list[0].url)?"":__t)+'","s1":"'+(null==(__t=the_data.large_cover.url_list[1].url)?"":__t)+'"},"m":{"w":"'+(null==(__t=the_data.video_width)?"":__t)+'","h":"'+(null==(__t=the_data.video_height)?"":__t)+'","s":"'+(null==(__t=the_data.medium_cover.url_list[0].url)?"":__t)+'","s1":"'+(null==(__t=the_data.medium_cover.url_list[1].url)?"":__t)+'"%>\' \r\n                                    src="'+(null==(__t=the_data.large_cover.url_list[0].url)?"":__t)+'"\r\n                                    onerror="this.src=\''+(null==(__t=the_data.large_cover.url_list[1].url)?"":__t)+'\'" />\r\n                                <div class="play-btn">\r\n                                    <div class="play-btn-arrow"></div>\r\n                                </div>\r\n                                <div class="desc">\r\n                                    <p class="play-count left"><span>'+(null==(__t=the_data.play_count)?"":__t)+'</span>次播放</p>\r\n                                    <p class="total-time right" data-duration="'+(null==(__t=the_data.duration)?"":__t)+'"></p>\r\n                                </div>\r\n                            </div>\r\n                        </a>\r\n                    </div>\r\n                    <div class="player-container" data-src="'+(null==(__t=the_data.mp4_url)?"":__t)+'" data-poster-src="'+(null==(__t=the_data.large_cover.url_list[0].url)?"":__t)+'">\r\n                        <video class="upload-video hidden" src="'+(null==(__t=the_data.mp4_url)?"":__t)+'" poster="'+(null==(__t=the_data.large_cover.url_list[0].url)?"":__t)+'" controls="controls" preload="none"></video>\r\n                    </div>\r\n                </div>\r\n                '),__p+="\r\n                \r\n                ",the_data.text&&(__p+="\r\n                    </div> <!-- end of orign -->\r\n                </div> <!-- end of comment-wrapper -->\r\n                "),__p+="\r\n\r\n                ",60==the_data.update_type&&(__p+='\r\n                <style>\r\n                .user-info {\r\n                    overflow:hidden;\r\n                    padding-left: 14px;\r\n                }\r\n                .user-info li {\r\n                    float: left;\r\n                    margin-right: 40px;\r\n                }\r\n                </style>\r\n                <ul class="user-info">\r\n                    <li>发表：'+(null==(__t=the_data.ugc_count)?"":__t)+"</li>\r\n                    <li>评论："+(null==(__t=the_data.comment_count)?"":__t)+"</li>\r\n                    <li>积分："+(null==(__t=the_data.point)?"":__t)+"</li>\r\n                </ul>\r\n                "),__p+="\r\n\r\n            </a>\r\n        </div>\r\n    </div>\r\n</li>\r\n"}__p+=""}return __p},EVENT="listview";eval("var DEFAULT_CONFIG = {\r\n	url: '',\r\n	has_more: false,\r\n	min_time: '',\r\n	max_time: '',\r\n	ctn: '',\r\n	is_god_comment: false,\r\n	offset: 0,\r\n	count: 40\r\n};\r\n\r\nvar htmlEntities = function htmlEntities(str){\r\n    return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\r\n};\r\n\r\nvar DEFAULT_DATA = {\r\n	is_god_comment: false,\r\n	is_detail: false,\r\n	channel: '',\r\n	htmlEntities: htmlEntities\r\n};\r\n\r\nvar EVENT_TYPE = {\r\n	LOAD_MORE: 'loadmore',\r\n	LOAD_LATEST: 'loadlatest',\r\n	LOAD_COMMENTS: 'loadcomments',\r\n	LOAD_MORE_COMMENTS: 'loadmore-comments',\r\n	APPEND_COMMENTS: 'append-comments'\r\n};\r\n\r\nfunction _init() {\r\n	listener.on('com.neihanshequ', EVENT, load);\r\n}\r\n\r\nfunction _offEvent() {\r\n	listener.off('com.neihanshequ', EVENT, load);\r\n}\r\n\r\nfunction canDoAjax(type, config) {\r\n	if(type === EVENT_TYPE.LOAD_MORE) {\r\n		return config.has_more;\r\n	}else if(type === EVENT_TYPE.LOAD_LATEST) {\r\n		return true;\r\n	}else if(type === EVENT_TYPE.LOAD_COMMENTS || \r\n			 type === EVENT_TYPE.LOAD_MORE_COMMENTS) {\r\n		return config.has_more;\r\n	} \r\n	return false;\r\n}\r\n\r\nfunction canDo(type, config) {\r\n	if(type === EVENT_TYPE.APPEND_COMMENTS) {\r\n		return true;\r\n	}\r\n	return false;\r\n}\r\n\r\nfunction getParams(type, config) {\r\n	var data = {};\r\n\r\n	if(type === EVENT_TYPE.LOAD_MORE) {\r\n		data = {\r\n			max_time: config.max_time\r\n		};\r\n		if('page' in config && 'count' in config) {\r\n			data = {\r\n				page: config.page,\r\n				count: config.count\r\n			};\r\n		}\r\n	}else if(type === EVENT_TYPE.LOAD_LATEST) {\r\n		data = {\r\n			min_time: config.min_time\r\n		};\r\n	}else if(type === EVENT_TYPE.LOAD_COMMENTS || \r\n			 type === EVENT_TYPE.LOAD_MORE_COMMENTS) {\r\n		data = {\r\n			offset: config.offset\r\n		};\r\n	} \r\n	return data;\r\n}\r\n\r\nfunction load(event, type, config) {\r\n	// config = $.extend({}, DEFAULT_CONFIG, config);\r\n	for(var key in DEFAULT_CONFIG) {\r\n		if(!config.hasOwnProperty(key)) {\r\n			config[key] = DEFAULT_CONFIG[key];\r\n		}\r\n	}\r\n\r\n	function __deferResolve(data) {\r\n		if(config.defer) {\r\n			config.defer.resolve(data);\r\n			delete config['defer'];\r\n		}\r\n	}\r\n	if(canDoAjax(type, config)) {\r\n		$('.loading-more').show();\r\n		_offEvent();\r\n		var paramData = getParams(type, config);\r\n		$.ajax({\r\n			url: config.url,\r\n			type: 'get',\r\n			dataType: 'json',\r\n			data: paramData\r\n		}).done(function(data) {\r\n			/**\r\n			 * 这里首先进行loading元素的消失，这样优先于添加数据的模块，可以确保消失过程动画不卡顿\r\n			 */\r\n			listener.trigger('bytefe.pull2refresh', 'reset');\r\n			if(data.message === 'success' || data.data.message == 'success') {\r\n				/**\r\n				 * 这里用timeout的形式触发，是为了延迟100ms来给前面loading元素消失动画\r\n				 * 足够的时间完成动画过程，避免渲染操作卡顿住消失动画\r\n				 */\r\n				setTimeout(function() {\r\n					_render(type, config, data);\r\n					__deferResolve(data);\r\n				}, 100);\r\n			}else {\r\n				console.log('onError', data.message);\r\n			}\r\n		}).fail(function() {\r\n			console.log('onError');\r\n			__deferResolve();\r\n		}).always(function() {\r\n			_init();\r\n		});	\r\n	}else if(canDo(type, config)) {\r\n		_render(type, config, config.data);\r\n	}else {\r\n		$('.loading-more').hide();\r\n	}\r\n}\r\n\r\nfunction _renderLoadMore(config, data) {\r\n	var d = $.extend({}, DEFAULT_DATA, data.data);\r\n	d.is_god_comment = config.is_god_comment;\r\n	var html = TEMPLATE(d);\r\n	$(config.ctn).hide().append(html).show();	\r\n}\r\n\r\nfunction _renderLoadLatest(config, data) {\r\n	var d = $.extend({}, DEFAULT_DATA, data.data);\r\n	d.is_god_comment = config.is_god_comment;\r\n	\r\n	var html = TEMPLATE(d);\r\n\r\n	$(config.ctn).prepend(html);\r\n\r\n	global_tip(data.data.tip);\r\n	\r\n}\r\n\r\nfunction _renderLoadComments(config, data) {\r\n	var hideSofa = false;\r\n	var hotTarget = $(config.ctn).find('.hot-comments');\r\n	var target = $(config.ctn).find('.comments');\r\n\r\n	if(data.data.top_comments && data.data.top_comments.length > 0) {\r\n	 	var html = TEMPLATE({data: data.data.top_comments, group_id: data.group_id, htmlEntities: htmlEntities});\r\n	 	hideSofa = true;\r\n	 	hotTarget.find('.comment-list').empty().append(html);	\r\n	 	hotTarget.find('.J-comments-count').text((data.data.top_comments||[]).length);\r\n	 	hotTarget.removeClass('hidden')\r\n	}else {\r\n	 	hotTarget.addClass('hidden');\r\n	}\r\n\r\n	if(data.data.recent_comments && data.data.recent_comments.length > 0) {\r\n		var html = TEMPLATE({data: data.data.recent_comments, group_id: data.group_id, htmlEntities: htmlEntities});\r\n		hideSofa = true;\r\n		\r\n		target.find('.comment-list').empty().append(html);\r\n		target.find('.J-comments-count').text(data.total_number - (data.data.top_comments||[]).length);\r\n		target.removeClass('hidden');\r\n	}else {\r\n		target.addClass('hidden');\r\n	}\r\n\r\n	// if(hideSofa) {\r\n	// 	$(config.ctn).find('.no-comments').hide();\r\n	// }else {\r\n	// 	$(config.ctn).find('.no-comments').show();\r\n	// }\r\n}\r\n\r\nfunction _renderLoadMoreComments(config, data) {\r\n	var target = $(config.ctn).find('.comments');\r\n	if(data.data.recent_comments && data.data.recent_comments.length > 0) {\r\n		var html = TEMPLATE({data: data.data.recent_comments, group_id: data.group_id, htmlEntities: htmlEntities});\r\n		target.find('.comment-list').append(html);\r\n		target.removeClass('hidden')\r\n		//$(config.ctn).append(html);\r\n	}\r\n}\r\n\r\nfunction _renderAppendComments(config, data) {\r\n	var target = $(config.ctn).find('.comments');\r\n	if(data.data.comments && data.data.comments.length > 0) {\r\n		//$(config.ctn).find('.no-comments').hide();\r\n		var html = TEMPLATE({data: data.data.comments, group_id: data.group_id, htmlEntities: htmlEntities});\r\n		target.find('.comment-list').prepend(html);\r\n		target.removeClass('hidden');\r\n		target.find('.J-comments-count').each(function(idx, el) {\r\n			el = $(el);\r\n			el.text(~~el.text()+data.data.comments.length);\r\n		});\r\n	}\r\n}\r\n\r\nvar renderMethodMap = {};\r\n\r\nrenderMethodMap[EVENT_TYPE.LOAD_MORE] = _renderLoadMore;\r\nrenderMethodMap[EVENT_TYPE.LOAD_LATEST] = _renderLoadLatest;\r\nrenderMethodMap[EVENT_TYPE.LOAD_COMMENTS] = _renderLoadComments;\r\nrenderMethodMap[EVENT_TYPE.LOAD_MORE_COMMENTS] = _renderLoadMoreComments;\r\nrenderMethodMap[EVENT_TYPE.APPEND_COMMENTS] = _renderAppendComments;\r\n\r\nfunction getRenderMethod(type) {\r\n	return renderMethodMap[type] || function() {};\r\n}\r\n\r\nvar afterRenderMethodMap = {};\r\n\r\nfunction _afterRenderComments(type, config, data) {\r\n	$(config.ctn).find('.timeago').timeago();\r\n	formatCountNumber();\r\n	loadLazyImage();\r\n}\r\n\r\nvar totalRenderedPostCount = 20;\r\nvar INSERT_AD_STEP = 40;\r\nvar latestADPos = 0;\r\nfunction _afterRenderPost(type, config, data) {\r\n	totalRenderedPostCount += data.data.data.length;\r\n	if(isNaN(totalRenderedPostCount)) {\r\n		return;\r\n	} \r\n	var $ctn = $(config.ctn);\r\n	$ctn.hide();\r\n\r\n	var appBanner = $('#appDownload');\r\n	var totalPost = $ctn.find('li.group-item');\r\n	var idx = Math.floor(latestADPos / INSERT_AD_STEP);\r\n	while(true) {\r\n		pos = idx*INSERT_AD_STEP-1;\r\n		if(pos > totalRenderedPostCount) {\r\n			break;\r\n		}else if(pos > latestADPos){\r\n			var clone = appBanner.clone();\r\n			clone.removeAttr('id');\r\n			clone.removeClass('fly-away');\r\n			clone.addClass('banner-in-list');\r\n			clone.data('adIdx', pos+1);\r\n			clone.insertAfter($(totalPost[pos]));\r\n			latestADPos = pos+1;\r\n		}\r\n		idx++;\r\n	}\r\n\r\n	if(!('gGroupIdList' in window)) {\r\n		window.gGroupIdList = [-1];\r\n	}\r\n\r\n	var len = gGroupIdList.length;\r\n	var list = [].concat(data.data.data);\r\n	if(type == EVENT_TYPE.LOAD_LATEST) {\r\n		list = list.reverse();\r\n	}\r\n	$(list).each(function(idx, d) {\r\n		var group = d.group || d;\r\n		if(type == EVENT_TYPE.LOAD_LATEST) {\r\n			gGroupIdList.unshift(''+group.group_id);\r\n		}else if(type == EVENT_TYPE.LOAD_MORE) {\r\n			gGroupIdList.splice(len-1, 0, ''+group.group_id);\r\n			len++;\r\n		}\r\n	});\r\n\r\n	saveGroupIdList(gGroupIdList);	\r\n	\r\n	formatCountNumber();\r\n\r\n\r\n	$ctn.show();\r\n}\r\n\r\nafterRenderMethodMap[EVENT_TYPE.LOAD_LATEST] = _afterRenderPost;\r\nafterRenderMethodMap[EVENT_TYPE.LOAD_MORE] = _afterRenderPost;\r\nafterRenderMethodMap[EVENT_TYPE.LOAD_COMMENTS] = _afterRenderComments;\r\nafterRenderMethodMap[EVENT_TYPE.LOAD_MORE_COMMENTS] = _afterRenderComments;\r\nafterRenderMethodMap[EVENT_TYPE.APPEND_COMMENTS] = _afterRenderComments;\r\n\r\nfunction getAfterRenderMethod(type) {\r\n	return afterRenderMethodMap[type] || function() {};\r\n}\r\n\r\nfunction _render(type, config, data) {\r\n\r\n	var renderMethod = getRenderMethod(type);\r\n	renderMethod(config, data);\r\n	\r\n	setTimeout(function() {\r\n		var afterRenderMethod = getAfterRenderMethod(type);\r\n		afterRenderMethod ? afterRenderMethod(type, config, data) : '';\r\n	}, 300);\r\n\r\n	_updateConfig(type, config, data);\r\n}\r\n\r\nfunction _updateConfig(type, config, data) {\r\n	if(type === EVENT_TYPE.LOAD_MORE) {\r\n		config.has_more = data.data.has_more && data.data.data.length > 0;\r\n		config.max_time = data.data.max_time || config.max_time;	\r\n\r\n		if('options' in data.data) {\r\n			config.page = data.data.options.page;\r\n			config.count = data.data.options.count;\r\n			config.has_more = data.data.hasmore;\r\n		}		\r\n	}else if(type === EVENT_TYPE.LOAD_LATEST) {\r\n		config.min_time = data.data.min_time || config.min_time;\r\n	}else if(type === EVENT_TYPE.LOAD_MORE_COMMENTS || \r\n			 type === EVENT_TYPE.LOAD_COMMENTS) {\r\n		config.offset += data.data.recent_comments.length;\r\n		config.has_more = data.has_more;\r\n	}\r\n\r\n	if(!config.has_more) {\r\n		$('.loading-more').hide();\r\n	}\r\n}\r\n\r\nmodule.exports = {\r\n	init: _init\r\n}")});
;define("common/listview/user_profile.js",function(require,exports,module){var TEMPLATE=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{}){__p+="";for(var i=0,len=data.length;len>i;i++){var the_data=data[i].group||data[i],comments=(is_god_comment?data[i].comment:null,data[i].comments||[]);if(__p+='\r\n<li class="group-item">\r\n    <div class="detail-wrapper">\r\n        <div class="header">\r\n            ',the_data.comment?__p+='\r\n            <a href="/user/'+(null==(__t=the_data.comment.user_id)?"":__t)+'/">\r\n                <img class="avatar lazy-load left" data-src="'+(null==(__t=the_data.comment.user_profile_image_url)?"":__t)+'" onerror="this.src=\'http://mat1.gtimg.com/www/mb/images/head_50.jpg\'" alt="">\r\n                <div class="name-time-wrapper left">\r\n                    <span class="name">'+(null==(__t=the_data.comment.user_name)?"":__t)+'</span>\r\n                    <span class="time timeago" title="'+(null==(__t=the_data.comment.create_time)?"":__t)+'">\r\n                        '+(null==(__t=the_data.comment.create_time)?"":__t)+"\r\n                    </span>\r\n                </div>\r\n            </a>\r\n            ":(__p+='\r\n            <a href="/user/'+(null==(__t=the_data.user.user_id)?"":__t)+'/">\r\n                <img class="avatar lazy-load left" data-src="'+(null==(__t=the_data.user.avatar_url)?"":__t)+'" onerror="this.src=\'http://mat1.gtimg.com/www/mb/images/head_50.jpg\'" alt="">\r\n                <div class="name-time-wrapper left">\r\n                    <span class="name">'+(null==(__t=the_data.user.name)?"":__t),the_data.user.user_verified&&(__p+="<i class='user_verified'  title=\"微博认证用户\"></i>"),__p+='</span>\r\n                    <span class="time timeago" title="'+(null==(__t=the_data.create_time)?"":__t)+'000">\r\n                        '+(null==(__t=the_data.create_time)?"":__t)+"\r\n                    </span>\r\n                </div>\r\n            </a>\r\n            "),__p+="\r\n\r\n            ",(gListViewConfig.showReport||gListViewConfig.showCommented||gListViewConfig.showDelete)&&(__p+='\r\n            <div class="other-btn right">\r\n                ',gListViewConfig.showReport&&(__p+='\r\n                <button class="report-btn">举报</button>\r\n                '),__p+="\r\n                ",gListViewConfig.showCommented&&(__p+='\r\n                <span class="commented-txt">评论了</span>\r\n                '),__p+="\r\n                ",gListViewConfig.showDelete&&(__p+='\r\n                <div class="delete-btn" data-group-id="'+(null==(__t=the_data.group_id)?"":__t)+'"></div>\r\n                '),__p+="\r\n            </div>\r\n            "),__p+="\r\n        </div>\r\n\r\n        ",the_data.comment&&(__p+='\r\n        <div class="comment-wrapper">\r\n            <div class="upload-txt mt {%if not the_data.comment.text%}no-mb{%endif%}">\r\n                '+(null==(__t=the_data.comment.text)?"":__t)+'\r\n            </div>\r\n            <div class="origin">\r\n        '),__p+='\r\n        \r\n        <div class="content-wrapper">\r\n            ',__p+="undefined"!=typeof noLink&&noLink?"\r\n            <a>\r\n            ":'\r\n            <a target="_blank" class="image share_url" href="/p'+(null==(__t=the_data.group_id)?"":__t)+'/" data-group-id="'+(null==(__t=the_data.group_id)?"":__t)+'">\r\n            ',__p+='\r\n                <div class="upload-txt {%if not the_data.content){%>no-mb{%endif%} {%if not the_data.large_image and not the_data.mp4_url%}no-mb{%endif%}">\r\n                    '+(null==(__t=the_data.content)?"":__t)+"\r\n                </div>\r\n                ",the_data.large_image&&(__p+='\r\n                <div class="img-wrapper">\r\n                    ',__p+=the_data.large_image.url_list?'\r\n                    <img \r\n                        class="lazy upload-img" \r\n                        onerror="this.src='+(null==(__t=the_data.large_image.url_list[1].url)?"":__t)+'" \r\n                        data-image-info=\'{"l":{"w":"'+(null==(__t=the_data.large_image.width)?"":__t)+'","h":"'+(null==(__t=the_data.large_image.height)?"":__t)+'","s":"'+(null==(__t=the_data.large_image.url_list[0].url)?"":__t)+'","s1":"'+(null==(__t=the_data.large_image.url_list[1].url)?"":__t)+'"},"m":{"w":"'+(null==(__t=the_data.middle_image.width)?"":__t)+'","h":"'+(null==(__t=the_data.middle_image.height)?"":__t)+'","s":"'+(null==(__t=the_data.middle_image.url_list[0].url)?"":__t)+'","s1":"'+(null==(__t=the_data.middle_image.url_list[1].url)?"":__t)+"\"}}'>\r\n                    ":'\r\n                    <img \r\n                        class="lazy upload-img" \r\n                        src="'+(null==(__t=the_data.large_image)?"":__t)+'" \r\n                        onerror="this.src='+(null==(__t=the_data.middle_image)?"":__t)+'" data-image-info=\'{"l":{"w":"","h":"","s":"'+(null==(__t=the_data.large_image)?"":__t)+'"},"m":{"w":"","h":"","s":"'+(null==(__t=the_data.middle_image)?"":__t)+"\"}}'>\r\n                    ",__p+="\r\n                </div>\r\n                "),__p+="\r\n\r\n                ",the_data.mp4_url&&(__p+='\r\n                <div class="video-container" id="videoContainer">\r\n                    <div class="poster-page">\r\n                        <a class="poster-link" href="javascript:;">\r\n                            <div class="wrapper img-wrapper">\r\n                                <img \r\n                                    class="lazy poster J-share-img"\r\n                                    data-image-info=\'{"l":{"w":"'+(null==(__t=the_data.video_width)?"":__t)+'","h":"'+(null==(__t=the_data.video_height)?"":__t)+'","s":"'+(null==(__t=the_data.large_cover.url_list[0].url)?"":__t)+'","s1":"'+(null==(__t=the_data.large_cover.url_list[1].url)?"":__t)+'"},"m":{"w":"'+(null==(__t=the_data.video_width)?"":__t)+'","h":"'+(null==(__t=the_data.video_height)?"":__t)+'","s":"'+(null==(__t=the_data.medium_cover.url_list[0].url)?"":__t)+'","s1":"'+(null==(__t=the_data.medium_cover.url_list[1].url)?"":__t)+"\"}}'\r\n                                    onerror=\"this.src='"+(null==(__t=the_data.large_cover.url_list[1].url)?"":__t)+'\'" />\r\n                                <div class="play-btn" style="margin-left/*\\**/: -38px \\9;">\r\n                                    <div class="play-btn-arrow"></div>\r\n                                </div>\r\n                                <div class="desc">\r\n                                    <p class="play-count left"><span>'+(null==(__t=the_data.play_count)?"":__t)+'</span>次播放</p>\r\n                                    <p class="total-time right" data-duration="'+(null==(__t=the_data.duration)?"":__t)+'"></p>\r\n                                </div>\r\n                            </div>\r\n                        </a>\r\n                    </div>\r\n                    <div class="player-container" data-src="'+(null==(__t=the_data.mp4_url)?"":__t)+'" data-poster-src="'+(null==(__t=the_data.large_cover.url_list[0].url)?"":__t)+'">\r\n                        <video class="upload-video hidden" src="'+(null==(__t=the_data.mp4_url)?"":__t)+'" poster="'+(null==(__t=the_data.large_cover.url_list[0].url)?"":__t)+'" controls="controls" preload="none"></video>\r\n                    </div>\r\n                </div>\r\n                '),__p+="\r\n            </a>\r\n        </div>\r\n\r\n        ",comments&&comments.length){__p+='\r\n        <div class="god-comments-wrapper">\r\n            <div class="header">\r\n                <span>神评论</span>\r\n            </div>\r\n            <ul>\r\n                ';for(var j=0,l=comments.length;l>j;j++){var c=comments[j];__p+='\r\n                <li>\r\n                    <div>\r\n                        <a target="_blank" href="/user/'+(null==(__t=c.user_id)?"":__t)+'/">\r\n                            <img class="avatar lazy-load left" data-src="'+(null==(__t=c.avatar_url)?"":__t)+'" onerror="this.src=\'http://mat1.gtimg.com/www/mb/images/head_50.jpg\';">\r\n                            <span class="name">'+(null==(__t=c.user_name)?"":__t)+'</span>\r\n                        </a>\r\n                        <span class="digg digg-comment ',c.user_digg&&(__p+="ed"),__p+='" data-user-id="'+(null==(__t=c.user_id)?"":__t)+'" data-comment-id="'+(null==(__t=c.comment_id)?"":__t)+'" data-group-id="'+(null==(__t=the_data.group_id)?"":__t)+'" data-exist-action-'+(null==(__t=c.comment_id)?"":__t)+'="{%if c.user_digg%}digg{%endif%}" data-count="'+(null==(__t=c.digg_count)?"":__t)+'">'+(null==(__t=c.digg_count)?"":__t)+"</span>\r\n                    </div>\r\n                    <div>\r\n                        <p>"+(null==(__t=c.text)?"":__t)+"</p>\r\n                    </div>\r\n                </li>\r\n                "}__p+="\r\n            </ul>\r\n        </div>\r\n        "}__p+="\r\n\r\n        ","undefined"!=typeof noOptions&&noOptions||(__p+='\r\n        <div class="options" data-group-id="'+(null==(__t=the_data.group_id)?"":__t)+'">\r\n            <ul>\r\n                <li class="digg-wrapper">\r\n                    <span class="digg">'+(null==(__t=the_data.digg_count)?"":__t)+'</span>\r\n                </li>\r\n                <li class="bury-wrapper">\r\n                    <span class="bury">'+(null==(__t=the_data.bury_count)?"":__t)+'</span>\r\n                </li> \r\n                <li class="repin-wrapper">\r\n                    <span class="repin">'+(null==(__t=the_data.favorite_count)?"":__t)+'</span>\r\n                </li>\r\n                \r\n                <li class="share-wrapper right"\r\n                    data-group-id="'+(null==(__t=the_data.group_id)?"":__t)+'" \r\n                    data-url="http://neihanshequ.com/p'+(null==(__t=the_data.group_id)?"":__t)+'/"\r\n                    data-text="'+(null==(__t=the_data.content)?"":__t)+'"\r\n\r\n                    ',the_data.large_image&&the_data.large_image.url_list?__p+='\r\n                    data-pic="'+(null==(__t=the_data.large_image.url_list[0].url)?"":__t)+'"\r\n                    ':(__p+="\r\n                        ",__p+=the_data.mp4_url?'\r\n                        data-pic="'+(null==(__t=the_data.large_cover.url_list[0].url)?"":__t)+'"\r\n                        ':'\r\n                        data-pic="'+(null==(__t=the_data.large_image)?"":__t)+'"\r\n                        ',__p+="\r\n                    "),__p+='\r\n                >\r\n                    <span class="share"></span>\r\n                </li>\r\n                <li class="post-comment-btn right">\r\n                    <span class="comment">'+(null==(__t=the_data.comment_count)?"":__t)+"</span>\r\n                </li> \r\n            </ul>\r\n        </div>\r\n        "),__p+="\r\n\r\n        ",the_data.comment&&(__p+="\r\n            </div> <!-- end of orign -->\r\n        </div> <!-- end of comment-wrapper -->\r\n        "),__p+="\r\n        \r\n    </div>\r\n</li>\r\n"}__p+=""}return __p},EVENT="user-profile-listview";eval("var DEFAULT_CONFIG = {\r\n	url: '',\r\n	has_more: false,\r\n	min_time: '',\r\n	max_time: '',\r\n	ctn: '',\r\n	is_god_comment: false,\r\n	offset: 0,\r\n	count: 40\r\n};\r\n\r\nvar htmlEntities = function htmlEntities(str){\r\n    return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\r\n};\r\n\r\nvar DEFAULT_DATA = {\r\n	is_god_comment: false,\r\n	is_detail: false,\r\n	channel: '',\r\n	htmlEntities: htmlEntities\r\n};\r\n\r\nvar EVENT_TYPE = {\r\n	LOAD_MORE: 'loadmore',\r\n	LOAD_LATEST: 'loadlatest',\r\n	LOAD_COMMENTS: 'loadcomments',\r\n	LOAD_MORE_COMMENTS: 'loadmore-comments',\r\n	APPEND_COMMENTS: 'append-comments'\r\n};\r\n\r\nfunction _init() {\r\n	listener.on('com.neihanshequ', EVENT, load);\r\n}\r\n\r\nfunction _offEvent() {\r\n	listener.off('com.neihanshequ', EVENT, load);\r\n}\r\n\r\nfunction canDoAjax(type, config) {\r\n	if(type === EVENT_TYPE.LOAD_MORE) {\r\n		return config.has_more;\r\n	}else if(type === EVENT_TYPE.LOAD_LATEST) {\r\n		return true;\r\n	}else if(type === EVENT_TYPE.LOAD_COMMENTS || \r\n			 type === EVENT_TYPE.LOAD_MORE_COMMENTS) {\r\n		return config.has_more;\r\n	} \r\n	return false;\r\n}\r\n\r\nfunction canDo(type, config) {\r\n	if(type === EVENT_TYPE.APPEND_COMMENTS) {\r\n		return true;\r\n	}\r\n	return false;\r\n}\r\n\r\nfunction getParams(type, config) {\r\n	var data = {};\r\n\r\n	if(type === EVENT_TYPE.LOAD_MORE) {\r\n		data = {\r\n			max_time: config.max_time\r\n		};\r\n		if('page' in config && 'count' in config) {\r\n			data = {\r\n				page: config.page,\r\n				count: config.count\r\n			};\r\n		}\r\n	}else if(type === EVENT_TYPE.LOAD_LATEST) {\r\n		data = {\r\n			min_time: config.min_time\r\n		};\r\n	}else if(type === EVENT_TYPE.LOAD_COMMENTS || \r\n			 type === EVENT_TYPE.LOAD_MORE_COMMENTS) {\r\n		data = {\r\n			offset: config.offset\r\n		};\r\n	} \r\n	return data;\r\n}\r\n\r\nfunction load(event, type, config) {\r\n	// config = $.extend({}, DEFAULT_CONFIG, config);\r\n	for(var key in DEFAULT_CONFIG) {\r\n		if(!config.hasOwnProperty(key)) {\r\n			config[key] = DEFAULT_CONFIG[key];\r\n		}\r\n	}\r\n\r\n	function __deferResolve(data) {\r\n		if(config.defer) {\r\n			config.defer.resolve(data);\r\n			delete config['defer'];\r\n		}\r\n	}\r\n	if(canDoAjax(type, config)) {\r\n		$('.loading-more').show();\r\n		_offEvent();\r\n		var paramData = getParams(type, config);\r\n		$.ajax({\r\n			url: config.url,\r\n			type: 'get',\r\n			dataType: 'json',\r\n			data: paramData\r\n		}).done(function(data) {\r\n			/**\r\n			 * 这里首先进行loading元素的消失，这样优先于添加数据的模块，可以确保消失过程动画不卡顿\r\n			 */\r\n			listener.trigger('bytefe.pull2refresh', 'reset');\r\n			if(data.message === 'success' || data.data.message == 'success') {\r\n				/**\r\n				 * 这里用timeout的形式触发，是为了延迟100ms来给前面loading元素消失动画\r\n				 * 足够的时间完成动画过程，避免渲染操作卡顿住消失动画\r\n				 */\r\n				setTimeout(function() {\r\n					_render(type, config, data);\r\n					__deferResolve(data);\r\n				}, 100);\r\n			}else {\r\n				console.log('onError', data.message);\r\n			}\r\n		}).fail(function() {\r\n			console.log('onError');\r\n			__deferResolve();\r\n		}).always(function() {\r\n			_init();\r\n		});	\r\n	}else if(canDo(type, config)) {\r\n		_render(type, config, config.data);\r\n	}else {\r\n		$('.loading-more').hide();\r\n	}\r\n}\r\n\r\nfunction _renderLoadMore(config, data) {\r\n	var d = $.extend({}, DEFAULT_DATA, data.data);\r\n	d.is_god_comment = config.is_god_comment;\r\n	var html = TEMPLATE(d);\r\n	$(config.ctn).hide().append(html).show();	\r\n}\r\n\r\nfunction _renderLoadLatest(config, data) {\r\n	var d = $.extend({}, DEFAULT_DATA, data.data);\r\n	d.is_god_comment = config.is_god_comment;\r\n	\r\n	var html = TEMPLATE(d);\r\n\r\n	$(config.ctn).prepend(html);\r\n\r\n	global_tip(data.data.tip);\r\n	\r\n}\r\n\r\nfunction _renderLoadComments(config, data) {\r\n	var hideSofa = false;\r\n	var hotTarget = $(config.ctn).find('.hot-comments');\r\n	var target = $(config.ctn).find('.comments');\r\n\r\n	if(data.data.top_comments && data.data.top_comments.length > 0) {\r\n	 	var html = TEMPLATE({data: data.data.top_comments, group_id: data.group_id, htmlEntities: htmlEntities});\r\n	 	hideSofa = true;\r\n	 	hotTarget.find('.comment-list').empty().append(html);	\r\n	 	hotTarget.find('.J-comments-count').text((data.data.top_comments||[]).length);\r\n	 	hotTarget.removeClass('hidden')\r\n	}else {\r\n	 	hotTarget.addClass('hidden');\r\n	}\r\n\r\n	if(data.data.recent_comments && data.data.recent_comments.length > 0) {\r\n		var html = TEMPLATE({data: data.data.recent_comments, group_id: data.group_id, htmlEntities: htmlEntities});\r\n		hideSofa = true;\r\n		\r\n		target.find('.comment-list').empty().append(html);\r\n		target.find('.J-comments-count').text(data.total_number - (data.data.top_comments||[]).length);\r\n		target.removeClass('hidden');\r\n	}else {\r\n		target.addClass('hidden');\r\n	}\r\n\r\n	// if(hideSofa) {\r\n	// 	$(config.ctn).find('.no-comments').hide();\r\n	// }else {\r\n	// 	$(config.ctn).find('.no-comments').show();\r\n	// }\r\n}\r\n\r\nfunction _renderLoadMoreComments(config, data) {\r\n	var target = $(config.ctn).find('.comments');\r\n	if(data.data.recent_comments && data.data.recent_comments.length > 0) {\r\n		var html = TEMPLATE({data: data.data.recent_comments, group_id: data.group_id, htmlEntities: htmlEntities});\r\n		target.find('.comment-list').append(html);\r\n		target.removeClass('hidden')\r\n		//$(config.ctn).append(html);\r\n	}\r\n}\r\n\r\nfunction _renderAppendComments(config, data) {\r\n	var target = $(config.ctn).find('.comments');\r\n	if(data.data.comments && data.data.comments.length > 0) {\r\n		//$(config.ctn).find('.no-comments').hide();\r\n		var html = TEMPLATE({data: data.data.comments, group_id: data.group_id, htmlEntities: htmlEntities});\r\n		target.find('.comment-list').prepend(html);\r\n		target.removeClass('hidden');\r\n		target.find('.J-comments-count').each(function(idx, el) {\r\n			el = $(el);\r\n			el.text(~~el.text()+data.data.comments.length);\r\n		});\r\n	}\r\n}\r\n\r\nvar renderMethodMap = {};\r\n\r\nrenderMethodMap[EVENT_TYPE.LOAD_MORE] = _renderLoadMore;\r\nrenderMethodMap[EVENT_TYPE.LOAD_LATEST] = _renderLoadLatest;\r\nrenderMethodMap[EVENT_TYPE.LOAD_COMMENTS] = _renderLoadComments;\r\nrenderMethodMap[EVENT_TYPE.LOAD_MORE_COMMENTS] = _renderLoadMoreComments;\r\nrenderMethodMap[EVENT_TYPE.APPEND_COMMENTS] = _renderAppendComments;\r\n\r\nfunction getRenderMethod(type) {\r\n	return renderMethodMap[type] || function() {};\r\n}\r\n\r\nvar afterRenderMethodMap = {};\r\n\r\nfunction _afterRenderComments(type, config, data) {\r\n	$(config.ctn).find('.timeago').timeago();\r\n	formatCountNumber();\r\n	loadLazyImage();\r\n}\r\n\r\nvar totalRenderedPostCount = 20;\r\nvar INSERT_AD_STEP = 40;\r\nvar latestADPos = 0;\r\nfunction _afterRenderPost(type, config, data) {\r\n	totalRenderedPostCount += data.data.data.length;\r\n	if(isNaN(totalRenderedPostCount)) {\r\n		return;\r\n	} \r\n	var $ctn = $(config.ctn);\r\n	$ctn.hide();\r\n\r\n	var appBanner = $('#appDownload');\r\n	var totalPost = $ctn.find('li.group-item');\r\n	var idx = Math.floor(latestADPos / INSERT_AD_STEP);\r\n	while(true) {\r\n		pos = idx*INSERT_AD_STEP-1;\r\n		if(pos > totalRenderedPostCount) {\r\n			break;\r\n		}else if(pos > latestADPos){\r\n			var clone = appBanner.clone();\r\n			clone.removeAttr('id');\r\n			clone.removeClass('fly-away');\r\n			clone.addClass('banner-in-list');\r\n			clone.data('adIdx', pos+1);\r\n			clone.insertAfter($(totalPost[pos]));\r\n			latestADPos = pos+1;\r\n		}\r\n		idx++;\r\n	}\r\n\r\n	if(!('gGroupIdList' in window)) {\r\n		window.gGroupIdList = [-1];\r\n	}\r\n\r\n	var len = gGroupIdList.length;\r\n	var list = [].concat(data.data.data);\r\n	if(type == EVENT_TYPE.LOAD_LATEST) {\r\n		list = list.reverse();\r\n	}\r\n	$(list).each(function(idx, d) {\r\n		var group = d.group || d;\r\n		if(type == EVENT_TYPE.LOAD_LATEST) {\r\n			gGroupIdList.unshift(''+group.group_id);\r\n		}else if(type == EVENT_TYPE.LOAD_MORE) {\r\n			gGroupIdList.splice(len-1, 0, ''+group.group_id);\r\n			len++;\r\n		}\r\n	});\r\n\r\n	saveGroupIdList(gGroupIdList);	\r\n	\r\n	formatCountNumber();\r\n\r\n\r\n	$ctn.show();\r\n}\r\n\r\nafterRenderMethodMap[EVENT_TYPE.LOAD_LATEST] = _afterRenderPost;\r\nafterRenderMethodMap[EVENT_TYPE.LOAD_MORE] = _afterRenderPost;\r\nafterRenderMethodMap[EVENT_TYPE.LOAD_COMMENTS] = _afterRenderComments;\r\nafterRenderMethodMap[EVENT_TYPE.LOAD_MORE_COMMENTS] = _afterRenderComments;\r\nafterRenderMethodMap[EVENT_TYPE.APPEND_COMMENTS] = _afterRenderComments;\r\n\r\nfunction getAfterRenderMethod(type) {\r\n	return afterRenderMethodMap[type] || function() {};\r\n}\r\n\r\nfunction _render(type, config, data) {\r\n\r\n	var renderMethod = getRenderMethod(type);\r\n	renderMethod(config, data);\r\n	\r\n	setTimeout(function() {\r\n		var afterRenderMethod = getAfterRenderMethod(type);\r\n		afterRenderMethod ? afterRenderMethod(type, config, data) : '';\r\n	}, 300);\r\n\r\n	_updateConfig(type, config, data);\r\n}\r\n\r\nfunction _updateConfig(type, config, data) {\r\n	if(type === EVENT_TYPE.LOAD_MORE) {\r\n		config.has_more = data.data.has_more && data.data.data.length > 0;\r\n		config.max_time = data.data.max_time || config.max_time;	\r\n\r\n		if('options' in data.data) {\r\n			config.page = data.data.options.page;\r\n			config.count = data.data.options.count;\r\n			config.has_more = data.data.hasmore;\r\n		}		\r\n	}else if(type === EVENT_TYPE.LOAD_LATEST) {\r\n		config.min_time = data.data.min_time || config.min_time;\r\n	}else if(type === EVENT_TYPE.LOAD_MORE_COMMENTS || \r\n			 type === EVENT_TYPE.LOAD_COMMENTS) {\r\n		config.offset += data.data.recent_comments.length;\r\n		config.has_more = data.has_more;\r\n	}\r\n\r\n	if(!config.has_more) {\r\n		$('.loading-more').hide();\r\n	}\r\n}\r\n\r\nmodule.exports = {\r\n	init: _init\r\n}")});
;define("common/util/bdshare.js",function(t,e,n){var o="6649976",i="http://s.share.baidu.com/",a=function(){var t=(new Date).getTime(),e=(new Date).getTime()+1e3,n=(new Date).getTime()+3e3;return t.toString(32)+e.toString(32)+n.toString(32)},r=function(t,e){for(var n=t.length,o="",i=1;e>=i;i++){var a=Math.floor(n*Math.random());o+=t.charAt(a)}return o},c=function(){var t=(new Date).toString(36),e=r("0123456789abcdefghijklmnopqrstuvwxyz",3);return t+e};n.exports=function(t,e){e=e||{};var n=a(),r=0,l="",u=document.title,d=e.wbuid||"",m=c(),s=(window.isAppPage?"app":"detail/list",encodeURIComponent(e.pic||"")),p=encodeURIComponent(e.url||""),h=encodeURIComponent(e.comment||""),f=encodeURIComponent(e.desc||"");"tsina"===t?u=(e.text||u)+(e.weibotext||l):("tqq"===t&&(e.text=e.text.replace("@今日头条","@headlineapp")),u=e.text||u),u=encodeURIComponent(u.substring(0,300));var g="?click=1&url="+p+"&uid="+o+"&to="+t+"&type=text&relateUid="+d+"&pic="+s+"&title="+u+"&key=&sign=on&desc="+f+"&comment="+h+"&searchPic=0&l="+n+"&linkid="+m+"&sloc=&apiType=0&buttonType="+r,w=i+g,b=i+"commit"+g+"&t="+Math.random(),v=function(){var t=[];return function(e){var n=t.push(new Image)-1;t[n].onload=function(){t[n]=t[n].onload=null},t[n].src=e}}();setTimeout(function(){v(b)},1500),window.open(w,"_blank","height=500,width=700,left=0,toolbar=no,menubar=no,scrollbars=no,resizable=no,location=no,status=no")}});
;define("common/util/user.js",function(n,e,o){var t="/auth/login/",r="/user/info/",c="/auth/connect/?type=neihanshequ&platform=",i=null,s=!1,a=function(n){if(n=n||{},!s){s=!0;var e=n.successCb||function(){},o=n.errorCb||function(){};$.ajax({url:t,type:"POST",dataType:"json",context:this,data:n.data,success:function(n){return s=!1,n=n||{},"success"!==n.message?o(n):(i=n.user,e(i),void listener.trigger("com.neihanshequ.user","change",i))},error:function(){s=!1,o({})}})}},u=function(n,e){var o=610,t=505,r=c+n,i=Math.max((window.screen.width-o)/2,0),s=Math.max((window.screen.height-t)/2,0),a="location=0,toolbar=0,status=0,resizable=0,scrollbars=1,width=610,height=505,top="+s+",left="+i;if(e&&e.openWindow){var u=window.open(r,"login",a);try{u.focus()}catch(h){}window.user={connected:function(){f(e)}}}else e&&e.next&&(r+="&next="+encodeURIComponent(e.next)),location.href=r},f=function(n){n=n||{};var e=(n.successCb||function(){},n.errorCb||function(){}),o=$.cookie("login_flag");o?h(n):e()},h=function(n){n=n||{};var e=n.successCb||function(){},o=n.errorCb||function(){};$.ajax({url:r,type:"get",cache:!1,dataType:"json",success:function(n){return n=n||{},"error"===n.message?o(n):(i=n,e(i),void listener.trigger("com.neihanshequ.user","change",i))},error:function(){o({})}})};o.exports={checkLogin:f,getUserInfo:h,loginByLoc:a,loginByOther:u}});
;define("common/util/userAction.js",function(e,t,n){function r(e){return function(t){return checkUserLogin()&&e(t),!1}}function a(e){b=$.extend({},y,e),$(e.ctn).delegate(".digg-wrapper","click",r(p)).delegate(".bury-wrapper","click",r(s)).delegate(".repin-wrapper","click",r(g)).delegate(".post-comment-btn","click",r(f)).delegate(".digg-comment","click",r(h)).delegate(".bury-comment","click",r(T)).delegate(".repost-comment","click",r(v)).delegate(".delete-btn","click",r(w)),$(e.ctn).delegate(".share-wrapper","mouseover",_),$(e.ctn).delegate(".share-wrapper","mouseout",x)}function o(e){return e.parents(".options").data("groupId")}function c(e){var t=e.parents(".options").data("commentId");return t||(t=e.data("commentId")),t}function i(e){return $.inArray(e,["digg","bury","repin"])>-1?"/m/api/item_action/":$.inArray(e,["comment_digg","comment_bury"])>-1?"/m/api/comment_action/":!1}function d(e,t,n){n=n||{};var r=i(e,t);if(r){var a={action:e,group_id:t,app_name:"neihanshequ_web"};-1!=e.indexOf("comment_")&&(a.action=e.replace("comment_",""),a.comment_id=n.commentId),$.ajax({url:r,type:"POST",dataType:"json",data:a}).done(function(e){listener.trigger("com.neihanshequ","popupTip",{text:n.popText||"操作成功"}),console.log(e)}).fail(function(){console.error("ERROR")})}}function u(e,t){var n=!1,r=".digg-wrapper",a=".bury-wrapper";t&&(r=".digg",a=".bury"),n=!1;var o=e.parent().find(r+".ed").length,c=e.parent().find(a+".ed").length;if(n=!(!o&&!c)){var i="您已顶过";c&&(i="您已踩过"),listener.trigger("com.neihanshequ","popupTip",{text:i})}return n}function m(e,t,n){var r=n?t:t.find("span"),a=~~r.text();"add"==e?a++:a--,r.text(a)}function p(e){var t=$(e.currentTarget);return u(t)||(t.addClass("ed"),m("add",t),d("digg",o(t))),!1}function s(e){var t=$(e.currentTarget);return u(t)||(t.addClass("ed"),m("add",t),d("bury",o(t))),!1}function g(e){var t=$(e.currentTarget),n="repin",r="收藏成功";return t.hasClass("ed")?(t.removeClass("ed"),m("remove",t),r="取消收藏"):(t.addClass("ed"),m("add",t)),d(n,o(t),{popText:r}),!1}function l(){window.scrollTo(0,$(".post-comment-wrapper").offset().top)}function f(e){if(b.isDetailPage)$("textarea#text").focus(),l();else{var t="/#to-comments";window.open("/p"+o($(e.currentTarget))+t,"_blank")}return!1}function h(e){return $ct=$(e.currentTarget),u($ct,!0)||($ct.addClass("ed"),m("add",$ct,!0),d("comment_digg",o($ct),{commentId:c($ct)})),!1}function T(e){return $ct=$(e.currentTarget),u($ct,!0)||($ct.addClass("ed"),m("add",$ct,!0),d("comment_bury",o($ct),{commentId:c($ct)})),!1}function v(e){var t=$(e.currentTarget),n=t.parents("li.comment-item"),r=n.find("p").text(),a=n.find(".name").text();return $("#text").val("").val("//@"+a+" :"+r).focus(),l(),I("text",0),!1}function w(e){var t=$(e.currentTarget),n=t.data("groupId"),r=function(){var e=~~$("#postCount").text().replace(/[\(\)]/gi,"");e--,e=0>e?0:e,$("#postCount").text("("+e+")")};return $.ajax({url:"/api/ugc/delete",data:{group_id:n},type:"POST",dataType:"json"}).done(function(){t.parents("li.group-item").remove(),listener.trigger("com.neihanshequ","popupTip"),r()}).fail(function(){}),!1}function _(e){var t=$(e.currentTarget);clearTimeout(window.__nh_showShareTimeId),window.__nh_showShareTimeId=setTimeout(function(){listener.trigger("com.neihanshequ","showShare",t,t.data())},100)}function x(){clearTimeout(window.__nh_showShareTimeId),window.__nh_showShareTimeId=setTimeout(function(){listener.trigger("com.neihanshequ","hideShare")},300)}var y={ctn:""},b={},I=function(e,t){var n=document.getElementById(e);if(n.setSelectionRange)n.focus(),n.setSelectionRange(t,t);else if(n.createTextRange){var r=n.createTextRange();r.collapse(!0),r.moveEnd("character",t),r.moveStart("character",t),r.select()}};n.exports={init:function(e){a(e)}}});